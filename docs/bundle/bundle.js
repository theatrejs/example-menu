(()=>{"use strict";var t,e,i,s,n={864:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(458),n=i(124);const t=new s.N$({$container:document.body});t.initiate(60),await t.preloadStage(n.A),await s.Sf.frame(),t.createStage(n.A),e()}catch(t){e(t)}}),1)},124:(t,e,i)=>{i.d(e,{A:()=>A});var s=i(458);const n=JSON.parse('{"sprite":{"width":192,"height":80},"frames":{"disabled":[{"x":64,"y":16,"width":64,"height":16}],"idle":[{"x":64,"y":32,"width":64,"height":16}],"focus":[{"x":64,"y":48,"width":64,"height":16}],"active":[{"x":64,"y":64,"width":64,"height":16},{"x":128,"y":64,"width":64,"height":16}]}}'),o=i.p+"45385cb9802e161df407.png";class a extends((0,s.RJ)([o])){$data;$timeline;$createTimeline(t,e){return new s.Kf([...t.map(((t,i)=>{const{x:n,y:a,width:r,height:h}=t,c=new s.kx({$frameSource:new s.F5(new s.I9(n/e.width,a/e.height),new s.I9((n+r)/e.width,(a+h)/e.height)),$sizeTarget:new s.I9(r,h),$textureColor:o});return new s.a3({$onEnter:()=>{this.setSprite(c)},$timecode:100*i})})),new s.a3({$onEnter:t=>{t.seekTimecode(0)},$timecode:100*t.length})])}actionActivate(){this.$timeline=this.$createTimeline(this.$data.frames.active,this.$data.sprite),this.$timeline.seekTimecode(0)}actionDisable(){this.$timeline=this.$createTimeline(this.$data.frames.disabled,this.$data.sprite),this.$timeline.seekTimecode(0)}actionFocus(){this.$timeline=this.$createTimeline(this.$data.frames.focus,this.$data.sprite),this.$timeline.seekTimecode(0)}actionRest(){this.$timeline=this.$createTimeline(this.$data.frames.idle,this.$data.sprite),this.$timeline.seekTimecode(0)}onCreate(){this.$data=n,this.actionRest()}onTick(t){this.$timeline.tick(t)}}const r=a,h=JSON.parse('{"sprite":{"width":192,"height":80},"frames":{"disabled":[{"x":64,"y":16,"width":64,"height":16}],"idle":[{"x":64,"y":32,"width":64,"height":16}],"focus":[{"x":64,"y":48,"width":64,"height":16}],"active":[{"x":64,"y":64,"width":64,"height":16},{"x":128,"y":64,"width":64,"height":16}]}}'),c=i.p+"1b9a71887e5413fa264c.png";class $ extends((0,s.RJ)([c])){$data;$timeline;$createTimeline(t,e){return new s.Kf([...t.map(((t,i)=>{const{x:n,y:o,width:a,height:r}=t,h=new s.kx({$frameSource:new s.F5(new s.I9(n/e.width,o/e.height),new s.I9((n+a)/e.width,(o+r)/e.height)),$sizeTarget:new s.I9(a,r),$textureColor:c});return new s.a3({$onEnter:()=>{this.setSprite(h)},$timecode:100*i})})),new s.a3({$onEnter:t=>{t.seekTimecode(0)},$timecode:100*t.length})])}actionActivate(){this.$timeline=this.$createTimeline(this.$data.frames.active,this.$data.sprite),this.$timeline.seekTimecode(0)}actionDisable(){this.$timeline=this.$createTimeline(this.$data.frames.disabled,this.$data.sprite),this.$timeline.seekTimecode(0)}actionFocus(){this.$timeline=this.$createTimeline(this.$data.frames.focus,this.$data.sprite),this.$timeline.seekTimecode(0)}actionRest(){this.$timeline=this.$createTimeline(this.$data.frames.idle,this.$data.sprite),this.$timeline.seekTimecode(0)}onCreate(){this.$data=h,this.actionRest()}onTick(t){this.$timeline.tick(t)}}const d=$,u=JSON.parse('{"sprite":{"width":192,"height":80},"frames":{"disabled":[{"x":64,"y":16,"width":64,"height":16}],"idle":[{"x":64,"y":32,"width":64,"height":16}],"focus":[{"x":64,"y":48,"width":64,"height":16}],"active":[{"x":64,"y":64,"width":64,"height":16},{"x":128,"y":64,"width":64,"height":16}]}}'),l=i.p+"67f54bb77cfb6805833b.png";class m extends((0,s.RJ)([l])){$data;$timeline;$createTimeline(t,e){return new s.Kf([...t.map(((t,i)=>{const{x:n,y:o,width:a,height:r}=t,h=new s.kx({$frameSource:new s.F5(new s.I9(n/e.width,o/e.height),new s.I9((n+a)/e.width,(o+r)/e.height)),$sizeTarget:new s.I9(a,r),$textureColor:l});return new s.a3({$onEnter:()=>{this.setSprite(h)},$timecode:100*i})})),new s.a3({$onEnter:t=>{t.seekTimecode(0)},$timecode:100*t.length})])}actionActivate(){this.$timeline=this.$createTimeline(this.$data.frames.active,this.$data.sprite),this.$timeline.seekTimecode(0)}actionDisable(){this.$timeline=this.$createTimeline(this.$data.frames.disabled,this.$data.sprite),this.$timeline.seekTimecode(0)}actionFocus(){this.$timeline=this.$createTimeline(this.$data.frames.focus,this.$data.sprite),this.$timeline.seekTimecode(0)}actionRest(){this.$timeline=this.$createTimeline(this.$data.frames.idle,this.$data.sprite),this.$timeline.seekTimecode(0)}onCreate(){this.$data=u,this.actionRest()}onTick(t){this.$timeline.tick(t)}}const p=m,f=JSON.parse('{"sprite":{"width":192,"height":80},"frames":{"disabled":[{"x":64,"y":16,"width":64,"height":16}],"idle":[{"x":64,"y":32,"width":64,"height":16}],"focus":[{"x":64,"y":48,"width":64,"height":16}],"active":[{"x":64,"y":64,"width":64,"height":16},{"x":128,"y":64,"width":64,"height":16}]}}'),g=i.p+"82de72dbd7b0f16cfa3e.png";class x extends((0,s.RJ)([g])){$data;$timeline;$createTimeline(t,e){return new s.Kf([...t.map(((t,i)=>{const{x:n,y:o,width:a,height:r}=t,h=new s.kx({$frameSource:new s.F5(new s.I9(n/e.width,o/e.height),new s.I9((n+a)/e.width,(o+r)/e.height)),$sizeTarget:new s.I9(a,r),$textureColor:g});return new s.a3({$onEnter:()=>{this.setSprite(h)},$timecode:100*i})})),new s.a3({$onEnter:t=>{t.seekTimecode(0)},$timecode:100*t.length})])}actionActivate(){this.$timeline=this.$createTimeline(this.$data.frames.active,this.$data.sprite),this.$timeline.seekTimecode(0)}actionDisable(){this.$timeline=this.$createTimeline(this.$data.frames.disabled,this.$data.sprite),this.$timeline.seekTimecode(0)}actionFocus(){this.$timeline=this.$createTimeline(this.$data.frames.focus,this.$data.sprite),this.$timeline.seekTimecode(0)}actionRest(){this.$timeline=this.$createTimeline(this.$data.frames.idle,this.$data.sprite),this.$timeline.seekTimecode(0)}onCreate(){this.$data=f,this.actionRest()}onTick(t){this.$timeline.tick(t)}}const w=x,v=i.p+"4378e9fa9e4ca0b2781ec67b69c8af0f.mp3",y=i.p+"f2651d13f4de25921433f7a8c179abd0.mp3";class E extends((0,s.RJ)([r,d,p,w,v,y])){$finiteStateMachineMenu;onBeforeRemove(){this.followers.forEach((t=>{this.stage.removeActor(t)}))}onCreate(){const t=200,e=this.stage.createActor(r).translate(new s.I9(0,36)),i=this.stage.createActor(p).translate(new s.I9(0,12)),n=this.stage.createActor(d).translate(new s.I9(0,-12)),o=this.stage.createActor(w).translate(new s.I9(0,-36));!0!==s.O3.get("continue")&&e.actionDisable(),n.actionDisable(),this.addFollower(e),this.addFollower(i),this.addFollower(n),this.addFollower(o);const a=()=>this.engine.getInput(s.nC.dT.Fm)||this.engine.getInput(s.nC.Ze.A)||this.engine.getInput(s.nC.Ze.d3),h=()=>this.engine.getInput(s.nC.dT.UP)||this.engine.getInput(s.nC.Ze.UP)||this.engine.getInput(s.nC.Ze.nR),c=()=>this.engine.getInput(s.nC.dT.PX)||this.engine.getInput(s.nC.Ze.PX)||this.engine.getInput(s.nC.Ze.Yx);this.$finiteStateMachineMenu=new s.EF([{$state:"INITIATE",$transitions:[{$state:"CONTINUESELECTED",$condition:({$timer:t})=>t>=800&&!0===s.O3.get("continue")},{$state:"NEWGAMESELECTED",$condition:({$timer:t})=>t>=800&&!0!==s.O3.get("continue")}]},{$state:"CONTINUESELECTED",$onEnter:({$previous:t})=>{e.actionFocus(),"INITIATE"!==t&&"CONTINUEACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>e.actionRest(),$transitions:[{$state:"CONTINUEACTIVATED",$condition:()=>!0===a()},{$state:"NEWGAMESELECTED",$condition:({$timer:e})=>e>=t&&!0===c()&&!1===h()&&!1===a()}]},{$state:"CONTINUEACTIVATED",$onEnter:()=>{e.actionActivate(),this.addSound(new s.AB({$audio:y,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:()=>{e.actionRest(),console.log("Continue")},$transitions:[{$state:"CONTINUESELECTED",$condition:({$timer:t})=>t>=800&&!1===a()}]},{$state:"NEWGAMESELECTED",$onEnter:({$previous:t})=>{i.actionFocus(),"INITIATE"!==t&&"NEWGAMEACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>i.actionRest(),$transitions:[{$state:"NEWGAMEACTIVATED",$condition:()=>!0===a()},{$state:"CONTINUESELECTED",$condition:({$timer:e})=>!0===s.O3.get("continue")&&e>=t&&!0===h()&&!1===c()&&!1===a()},{$state:"QUITSELECTED",$condition:({$timer:e})=>e>=t&&!0===c()&&!1===h()&&!1===a()}]},{$state:"NEWGAMEACTIVATED",$onEnter:()=>{i.actionActivate(),this.addSound(new s.AB({$audio:y,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:()=>{i.actionRest(),!0!==s.O3.get("continue")&&(e.actionRest(),s.O3.set("continue",!0)),console.log("New Game")},$transitions:[{$state:"NEWGAMESELECTED",$condition:({$timer:t})=>t>=800&&!1===a()}]},{$state:"QUITSELECTED",$onEnter:({$previous:t})=>{o.actionFocus(),"QUITACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>o.actionRest(),$transitions:[{$state:"QUITACTIVATED",$condition:()=>!0===a()},{$state:"NEWGAMESELECTED",$condition:({$timer:e})=>e>=t&&!0===h()&&!1===c()&&!1===a()}]},{$state:"QUITACTIVATED",$onEnter:()=>{o.actionActivate(),this.addSound(new s.AB({$audio:y,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:()=>{o.actionRest(),!0===s.O3.get("continue")&&(e.actionDisable(),s.O3.set("continue",!1)),console.log("Quit")},$transitions:[{$state:"QUITSELECTED",$condition:({$timer:t})=>t>=800&&!1===a()}]}]),this.$finiteStateMachineMenu.initiate("INITIATE")}onTick(t){this.$finiteStateMachineMenu.update(t)}}const T=E;class b extends((0,s.On)([T])){onCreate(){this.engine.setColor(new s.Pq(27/255,36/255,71/255)),this.engine.setResolution(new s.I9(480,360)),this.createActor(T)}}const A=b},458:(t,e,i)=>{i.d(e,{F5:()=>L,Ag:()=>F,RJ:()=>O,Ig:()=>s,Z5:()=>n,Jo:()=>D,nC:()=>r,N$:()=>B,_p:()=>ot,wc:()=>at,IY:()=>rt,EF:()=>P,FZ:()=>z,hO:()=>h,O3:()=>c,Mt:()=>N,AB:()=>M,kx:()=>_,BI:()=>V,On:()=>G,$V:()=>ht,mr:()=>ct,kd:()=>$t,Mh:()=>dt,Ce:()=>ut,c0:()=>lt,Kf:()=>W,a3:()=>j,Sf:()=>$,I9:()=>it,Pq:()=>st,Hx:()=>nt});var s={};i.r(s),i.d(s,{u5:()=>l,g5:()=>m,DU:()=>p});var n={};i.r(n),i.d(n,{Ok:()=>f,WG:()=>g,eg:()=>x,Bg:()=>w});var o={};i.r(o),i.d(o,{A:()=>v,PX:()=>T,Yx:()=>A,nR:()=>b,d3:()=>y,UP:()=>E,xo:()=>S,YX:()=>C});var a={};i.r(a),i.d(a,{PX:()=>k,Fm:()=>R,UP:()=>I});var r={};i.r(r),i.d(r,{Ze:()=>o,dT:()=>a});var h={};i.r(h),i.d(h,{n:()=>U});var c={};i.r(c),i.d(c,{get:()=>X,has:()=>q,remove:()=>Y,set:()=>H});var $={};i.r($),i.d($,{deduplicate:()=>J,extract:()=>Z,frame:()=>K,ready:()=>Q,sleep:()=>tt,uuid:()=>et});const d=[["StickLeftLeft","StickLeftRight"],["StickLeftUp","StickLeftDown"],["StickRightLeft","StickRightRight"],["StickRightUp","StickRightDown"]],u=["ClusterRightButtonBottom","ClusterRightButtonRight","ClusterRightButtonLeft","ClusterRightButtonTop","ClusterFrontButtonTopLeft","ClusterFrontButtonTopRight","ClusterFrontButtonBottomLeft","ClusterFrontButtonBottomRight","ClusterCenterButtonLeft","ClusterCenterButtonRight","StickLeftButton","StickRightButton","ClusterLeftButtonTop","ClusterLeftButtonBottom","ClusterLeftButtonLeft","ClusterLeftButtonRight","ClusterCenterButtonCenter"];const l="DYNAMIC",m="KINETIC",p="STATIC",f="audio/mpeg",g="audio/wave",x="image/jpeg",w="image/png",v="ClusterRightButtonBottom",y="ClusterCenterButtonRight",E="ClusterLeftButtonTop",T="ClusterLeftButtonBottom",b="StickLeftUp",A="StickLeftDown",S="VibrateEnd",C="VibrateStart",R="Enter",I="ArrowUp",k="ArrowDown",U=Math.PI/180;class L{$maximum;$minimum;get center(){return this.minimum.clone().add(this.halfSize)}get halfSize(){return this.size.clone().scale(.5)}get maximum(){return this.$maximum}get minimum(){return this.$minimum}get size(){return this.$maximum.clone().subtract(this.$minimum)}constructor(t,e){this.$maximum=e,this.$minimum=t}static distanceManhattan(t,e){const i=L.distanceX(t,e),s=L.distanceY(t,e);return i>0||s>0?Math.max(i,0)+Math.max(s,0):i+s}static distanceX(t,e){return Math.abs(e.center.x-t.center.x)-(t.halfSize.x+e.halfSize.x)}static distanceY(t,e){return Math.abs(e.center.y-t.center.y)-(t.halfSize.y+e.halfSize.y)}static from(t){return t.clone()}static overlapX(t,e){const i=Math.abs(e.center.x-t.center.x);return t.halfSize.x+e.halfSize.x-i}static overlapY(t,e){const i=Math.abs(e.center.y-t.center.y);return t.halfSize.y+e.halfSize.y-i}clone(){return new L(this.$minimum,this.$maximum)}translate(t){return this.$maximum=this.$maximum.clone().add(t),this.$minimum=this.$minimum.clone().add(t),this}}class F{static preloadables=[];$collider;$components;$followers;$sounds;$sprite;$stage;$translation;$uuid;$vibrations;$zIndex;get collider(){return this.$collider}get engine(){return this.stage.engine}get followers(){return Array.from(this.$followers)}get sounds(){return this.$sounds}get sprite(){return this.$sprite}get stage(){return this.$stage}get translation(){return this.$translation}get uuid(){return this.$uuid}get vibrations(){return this.$vibrations}get zIndex(){return this.$zIndex}constructor(t){this.$stage=t,this.$components={},this.$followers=new Set,this.$sounds=[],this.$translation=new it(0,0),this.$uuid=et(),this.$vibrations=[],this.$zIndex=0}addFollower(t){return this.$followers.add(t),this}addSound(t){return this.$sounds.push(t),this}addVibration(t){return this.$vibrations.push(t),this}getComponent(t){return this.$components[t]}hasCollider(){return this.$collider instanceof D}hasComponent(t){return!0===this.$components.hasOwnProperty(t)}hasFollower(t){return!0===this.$followers.has(t)}hasSprite(){return this.$sprite instanceof _}onAfterRemove(){}onBeforeRemove(){}onCollide({$actor:t,$east:e,$north:i,$south:s,$west:n}){}onCollideEnter({$actor:t,$east:e,$north:i,$south:s,$west:n}){}onCollideLeave(t){}onCreate(){}onSoundFinish(t){}onTick(t){}removeFollower(t){return this.$followers.delete(t),this}removeSound(t){return Z(t,this.$sounds),this}removeSounds(){return this.$sounds=[],this}removeVibration(t){return Z(t,this.$vibrations),this}removeVibrations(){return this.$vibrations=[],this}setCollider(t){return this.$collider=t,this}setComponent(t,e){return this.$components[t]=e,this}setSprite(t){return this.$sprite=t,this}setZIndex(t){return this.$zIndex=t,this}translate(t){const e=t.clone();return Array.from(this.$followers).forEach((t=>{!1!==this.stage.hasActor(t)?t.translate(e):this.$followers.delete(t)})),this.$translation.add(e),this}translateTo(t){const e=t.clone().subtract(this.$translation);return Array.from(this.$followers).forEach((t=>{!1!==this.stage.hasActor(t)?t.translate(e):this.$followers.delete(t)})),this.$translation.add(e),this}}function O(t=[]){const e=new Set;return t.forEach((t=>{if("string"!=typeof t)typeof t!=typeof F||t.preloadables.forEach((t=>{!0!==e.has(t)&&e.add(t)}));else{if(!0===e.has(t))return;e.add(t)}})),class extends F{static preloadables=Array.from(e)}}class D{$boundaries;$traversable;$type;get boundaries(){return this.$boundaries}get traversable(){return this.$traversable}get type(){return this.$type}constructor({$boundaries:t,$traversable:e=!1,$type:i}){this.$boundaries=t,this.$traversable=e,this.$type=i}}class B{$color;$container;$loop;$next;$preloaded;$resolution;$stage;$systemActor;$systemAudio;$systemCollision;$systemInput;$systemRender;$systemVibration;$uuid;get container(){return this.$container}get stage(){return this.$stage}get uuid(){return this.$uuid}constructor({$color:t=new st(0,0,0),$container:e,$resolution:i=new it(320,240)}){this.$color=t,this.$container=e,this.$resolution=i,this.$uuid=et(),this.$loop=new z(this.tick.bind(this)),this.$preloaded=new Set,this.$systemActor=new ht,this.$systemAudio=new ct,this.$systemCollision=new $t,this.$systemInput=new dt({$container:this.$container}),this.$systemRender=new ut({$color:this.$color,$container:this.$container,$resolution:this.$resolution}),this.$systemVibration=new lt}$createStage(t){this.$stage=new t(this),this.$stage.onCreate()}createStage(t){this.$next=t}getInput(...t){return this.$systemInput.getInput(...t)}getInputAnalog(...t){return this.$systemInput.getInputAnalog(...t)}hasAssetLoaded(t){return!0===this.$preloaded.has(t)}initiate(t=60){this.$loop.initiate(t),this.$systemInput.initiate(),this.$systemRender.initiate()}preloadStage(t){const e=[];return J(t.preloadables).forEach((t=>{if(!0===this.hasAssetLoaded(t))return;if(this.$preloaded.add(t),!0===this.$systemAudio.hasAssetLoaded(t))return;if(!0===this.$systemRender.hasAssetLoaded(t))return;const i=new Promise((e=>{fetch(t).then((t=>{switch(t.headers.get("Content-Type")){case x:case w:this.$systemRender.loadTexture(t).then((t=>{e(t)}));break;case f:case g:this.$systemAudio.loadAudio(t).then((t=>{e(t)}));break;default:e(void 0)}}))}));e.push(i)})),Promise.all(e)}setColor(...t){return this.$systemRender.setColor(...t)}setResolution(...t){return this.$systemRender.setResolution(...t)}terminate(){this.$loop.terminate(),this.$createStage(V),this.tick(0),this.$systemInput.terminate(),this.$systemRender.terminate(),this.$systemAudio.terminate(),this.$systemVibration.terminate()}tick(t){if(typeof this.$next==typeof V){const t=this.$next;this.$next=void 0,this.$createStage(t)}void 0!==this.$stage&&(this.$systemInput.tick(),this.$systemActor.tick({$stage:this.$stage,$timetick:t}),this.$systemCollision.tick(this.$stage),this.$systemRender.tick(this.$stage),this.$systemAudio.tick(this.$stage),this.$systemVibration.tick({$stage:this.$stage,$timetick:t}))}}class P{$initiated;$previous;$state;$states;$timer;constructor(t){this.$initiated=!1,this.$states=new Map,this.$timer=0,t.forEach((t=>{this.$states.set(t.$state,t)}))}initiate(t){!0!==this.$initiated&&(this.$previous=this.$state,this.$state=this.$states.get(t),"function"==typeof this.$state.$onEnter&&this.$state.$onEnter({$previous:void 0}),this.$initiated=!0)}update(t){if(!1!==this.$initiated){this.$timer+=t;for(let t of this.$state.$transitions){let e;void 0!==this.$previous&&(e=this.$previous.$state);const i=this.$state.$state,s=t.$state;if(!0===t.$condition({$previous:e,$timer:this.$timer})){"function"==typeof this.$state.$onLeave&&this.$state.$onLeave({$timer:this.$timer,$next:s}),this.$timer=0,this.$previous=this.$state,this.$state=this.$states.get(s),"function"==typeof this.$state.$onEnter&&this.$state.$onEnter({$previous:i});break}}}}}class z{$handler;$identifier;$timePrevious;$scope;constructor(t,e=window){this.$handler=t,this.$scope=e}$loop(t){const e=performance.now();if(void 0!==this.$timePrevious){const i=e-this.$timePrevious,s=t,n=Math.min(s,i);this.$handler(n)}this.$identifier=this.$scope.requestAnimationFrame(this.$loop.bind(this,t)),this.$timePrevious=e}initiate(t=60){this.$loop(1e3/t)}terminate(){void 0!==this.$identifier&&(this.$scope.cancelAnimationFrame(this.$identifier),this.$timePrevious=void 0)}}class N{static attributes={attributePosition:"vec2",attributeUvmapping:"vec2"};static sourceFragment="precision highp float;uniform sampler2D uniformTextureColor;uniform sampler2D uniformTextureOpacity;uniform vec2 uniformTranslationPointOfView;varying vec2 varyingUvmapping;void main(void) {vec4 colorTextureColor = texture2D(uniformTextureColor, varyingUvmapping);vec4 colorTextureOpacity = texture2D(uniformTextureOpacity, varyingUvmapping);float alpha = colorTextureColor.a * colorTextureOpacity.r;gl_FragColor = vec4(colorTextureColor.rgb, alpha);}";static sourceVertex="attribute vec2 attributePosition;attribute vec2 attributeUvmapping;uniform vec2 uniformAspect;uniform vec2 uniformSize;uniform vec2 uniformTranslation;uniform vec2 uniformTranslationPointOfView;varying vec2 varyingUvmapping;void main(void) {varyingUvmapping = attributeUvmapping;vec2 position = (attributePosition * uniformSize + uniformTranslation);vec2 projection = 2.0 * (position - uniformTranslationPointOfView) / uniformAspect;gl_Position = vec4(projection, 0.0, 1.0);}";static uniforms={uniformAspect:"vec2",uniformSize:"vec2",uniformTextureColor:"sampler2D",uniformTextureOpacity:"sampler2D",uniformTranslation:"vec2",uniformTranslationPointOfView:"vec2"}}class M{$audio;$durationFadeOut;$loop;$volume;get audio(){return this.$audio}get durationFadeOut(){return this.$durationFadeOut}get loop(){return this.$loop}get volume(){return this.$volume}constructor({$audio:t,$durationFadeOut:e=1e3/60,$loop:i=!1,$volume:s=1}){this.$audio=t,this.$durationFadeOut=e,this.$loop=i,this.$volume=s}}class _{$frameSource;$frameSourceSerialized;$sizeTarget;$textureColor;$textureOpacity;get frameSource(){return this.$frameSource}get frameSourceSerialized(){return this.$frameSourceSerialized}get sizeTarget(){return this.$sizeTarget}get textureColor(){return this.$textureColor}get textureOpacity(){return this.$textureOpacity}constructor({$frameSource:t=new L(new it(0,0),new it(1,1)),$sizeTarget:e,$textureColor:i,$textureOpacity:s}){this.$frameSource=t,this.$sizeTarget=e,this.$textureColor=i,this.$textureOpacity=s,this.$frameSourceSerialized=JSON.stringify([[t.minimum.x,t.minimum.y],[t.maximum.x,t.maximum.y]])}}class V{static preloadables=[];$actors;$engine;$pointOfView;$uuid;get actors(){return this.$actors}get engine(){return this.$engine}get pointOfView(){return this.$pointOfView}get uuid(){return this.$uuid}constructor(t){this.$engine=t,this.$actors=[],this.$pointOfView=this.createActor(F),this.$uuid=et()}createActor(t=F){const e=new t(this);return this.$actors.push(e),e.onCreate(),e}hasActor(t){return-1!==this.$actors.indexOf(t)}onCreate(){}removeActor(t){const e=this.$actors.indexOf(t);-1!==e&&(t.onBeforeRemove(),this.$actors.splice(e,1),t.onAfterRemove())}removeActors(){for(;this.$actors.length>0;)this.removeActor(this.$actors[0])}setPointOfView(t){this.$pointOfView=t}}function G(t=[]){const e=new Set;return t.forEach((t=>{if("string"!=typeof t)typeof t!=typeof F||t.preloadables.forEach((t=>{!0!==e.has(t)&&e.add(t)}));else{if(!0===e.has(t))return;e.add(t)}})),class extends V{static preloadables=Array.from(e)}}function X(t){const e=window.localStorage.getItem(t);if(null!==e)return JSON.parse(e)}function q(t){return null!==window.localStorage.getItem(t)}function Y(t){window.localStorage.removeItem(t)}function H(t,e){const i=JSON.stringify(e);void 0!==i&&window.localStorage.setItem(t,i)}class W{$keyframes;$timecode;get timecode(){return this.$timecode}constructor(t=[]){this.$keyframes=[...t].sort(((t,e)=>t.timecode-e.timecode)),this.$timecode=0}seekName(t){const e=this.$keyframes.find((e=>e.name===t));return void 0!==e&&this.seekTimecode(e.timecode),this}seekTimecode(t){return this.$timecode=t,this.$keyframes.forEach((t=>{t.timecode===this.$timecode&&t.onEnter(this)})),this}tick(t){if(0===t)return this;const e=this.$timecode;this.$timecode+=t;const i=this.$timecode;return this.$keyframes.forEach((t=>{t.timecode<=e||t.timecode>i||t.onEnter(this)})),this}}class j{$name;$onEnter;$timecode;get name(){return this.$name}get onEnter(){return this.$onEnter}get timecode(){return this.$timecode}constructor({$name:t,$onEnter:e,$timecode:i}){this.$name=t,this.$onEnter=e,this.$timecode=i}}function J(t){return Array.from(new Set(t))}function Z(t,e){const i=e.indexOf(t);return-1===i?[]:e.splice(i,1)}function K(){return new Promise((t=>{window.requestAnimationFrame(t)}))}function Q(){return new Promise((t=>{let e;const i=()=>{!1!==navigator.userActivation.hasBeenActive?(window.cancelAnimationFrame(e),t()):e=window.requestAnimationFrame(i)};e=window.requestAnimationFrame(i)}))}function tt(t){return new Promise((e=>{window.setTimeout(e,t)}))}function et(){return window.crypto.randomUUID()}class it{$x;$y;get x(){return this.$x}get y(){return this.$y}constructor(t,e){this.$x=t,this.$y=e}static from(t){return t.clone()}add(t){const e=this.$x,i=this.$y;return this.$x=e+t.x,this.$y=i+t.y,this}clone(){const t=this.$x,e=this.$y;return new it(t,e)}equal(t){return this.$x===t.x&&this.$y===t.y}length(){const t=this.$x,e=this.$y;return Math.sqrt(t*t+e*e)}multiply(t){const e=this.$x,i=this.$y;return this.$x=e*t.x,this.$y=i*t.y,this}negate(){const t=this.$x,e=this.$y;return this.$x=-t,this.$y=-e,this}normalize(){const t=this.$x,e=this.$y;let i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i)),this.$x=t*i,this.$y=e*i,this}rotate(t){const e=this.$x,i=this.$y,s=t*U,n=Math.cos(s),o=Math.sin(s);return this.$x=e*n-i*o,this.$y=e*o+i*n,this}scale(t){const e=this.$x,i=this.$y;return this.$x=e*t,this.$y=i*t,this}subtract(t){const e=this.$x,i=this.$y;return this.$x=e-t.x,this.$y=i-t.y,this}}class st{$x;$y;$z;get x(){return this.$x}get y(){return this.$y}get z(){return this.$z}constructor(t,e,i){this.$x=t,this.$y=e,this.$z=i}static from(t){return t.clone()}add(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e+t.x,this.$y=i+t.y,this.$z=s+t.z,this}clone(){const t=this.$x,e=this.$y,i=this.$z;return new st(t,e,i)}equal(t){return this.$x===t.x&&this.$y===t.y&&this.$z===t.z}length(){const t=this.$x,e=this.$y,i=this.$z;return Math.sqrt(t*t+e*e+i*i)}multiply(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e*t.x,this.$y=i*t.y,this.$z=s*t.z,this}negate(){const t=this.$x,e=this.$y,i=this.$z;return this.$x=-t,this.$y=-e,this.$z=-i,this}normalize(){const t=this.$x,e=this.$y,i=this.$z;let s=t*t+e*e+i*i;return s>0&&(s=1/Math.sqrt(s)),this.$x=t*s,this.$y=e*s,this.$z=i*s,this}rotate(t){const e=this.$x,i=this.$y,s=this.$z,n=t.x,o=t.y,a=t.z;let r=o*s-a*i,h=a*e-n*s,c=n*i-o*e,$=o*c-a*h,d=a*r-n*c,u=n*h-o*r;const l=2*t.w;return r*=l,h*=l,c*=l,$*=2,d*=2,u*=2,this.$x=e+r+$,this.$y=i+h+d,this.$z=s+c+u,this}scale(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e*t,this.$y=i*t,this.$z=s*t,this}subtract(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e-t.x,this.$y=i-t.y,this.$z=s-t.z,this}}class nt{$duration;$intensityFrequencyHigh;$intensityFrequencyLow;get duration(){return this.$duration}get intensityFrequencyHigh(){return this.$intensityFrequencyHigh}get intensityFrequencyLow(){return this.$intensityFrequencyLow}constructor({$duration:t,$intensityFrequencyHigh:e,$intensityFrequencyLow:i}){this.$duration=t,this.$intensityFrequencyHigh=e,this.$intensityFrequencyLow=i}}class ot extends Event{$code;$data;get code(){return this.$code}get data(){return this.$data}constructor(t,e,i){super(t),this.$code=e,this.$data=i}}class at extends Event{$code;$value;get code(){return this.$code}get value(){return this.$value}constructor(t,e,i){super(t),this.$code=e,this.$value=i}}class rt extends Event{$code;get code(){return this.$code}constructor(t,e){super(t),this.$code=e}}class ht{tick({$stage:t,$timetick:e}){t.actors.forEach((t=>{t.onTick(e)}))}}class ct{static DELAYCONTEXTCLEARSAFE=1e3;$cache;$context;$mappingSoundsPlaying;constructor(){this.$cache=new Map,this.$context=new AudioContext,this.$mappingSoundsPlaying=new Map}$createValuesCurveFadeOut(t){return[1*t-1,0*t-1]}$loadAudio(t){return new Promise((e=>{t.arrayBuffer().then((i=>this.$context.decodeAudioData(i).then((i=>{this.$cache.set(t.url,i),e(i)}))))}))}$prepareAudio(t){!0!==this.$cache.has(t)&&(this.$cache.set(t,void 0),fetch(t).then((t=>this.$loadAudio(t))))}$terminateSound(t){const{$audio:e,$gain:i,$startTime:s}=this.$mappingSoundsPlaying.get(t);!1===t.loop&&this.$context.currentTime>s+Math.max(0,e.buffer.duration-t.durationFadeOut/1e3)||(i.gain.cancelScheduledValues(this.$context.currentTime),i.gain.setValueCurveAtTime(this.$createValuesCurveFadeOut(t.volume),this.$context.currentTime,Math.min(e.buffer.duration,t.durationFadeOut/1e3)),this.$mappingSoundsPlaying.delete(t),e.onended=()=>{e.disconnect(),i.disconnect()})}hasAssetLoaded(t){return!0===this.$cache.has(t)}loadAudio(t){return!0===this.$cache.has(t.url)?new Promise((e=>{e(this.$cache.get(t.url))})):(this.$cache.set(t.url,void 0),this.$loadAudio(t))}terminate(){let t=0;Array.from(this.$mappingSoundsPlaying.keys()).forEach((e=>{e.durationFadeOut>t&&(t=e.durationFadeOut),this.$terminateSound(e)})),window.setTimeout((()=>{this.$context.close(),this.$context=void 0}),t+ct.DELAYCONTEXTCLEARSAFE)}tick(t){const e=Array.from(this.$mappingSoundsPlaying.keys());t.actors.forEach((t=>{t.sounds.forEach((i=>{if(!0===this.$mappingSoundsPlaying.has(i))return void Z(i,e);if(this.$prepareAudio(i.audio),void 0===this.$cache.get(i.audio))return;const s=this.$cache.get(i.audio),n=this.$context.createBufferSource();n.buffer=s,n.connect(this.$context.destination),n.start(0);const o=this.$context.createGain();o.gain.value=i.volume-1,o.connect(this.$context.destination),n.connect(o),this.$mappingSoundsPlaying.set(i,{$audio:n,$gain:o,$startTime:this.$context.currentTime}),!0!==i.loop?(o.gain.setValueCurveAtTime(this.$createValuesCurveFadeOut(i.volume),this.$context.currentTime+Math.max(0,n.buffer.duration-i.durationFadeOut/1e3),Math.min(n.buffer.duration,i.durationFadeOut/1e3)),n.onended=()=>{n.disconnect(),o.disconnect(),this.$mappingSoundsPlaying.delete(i),t.removeSound(i),t.onSoundFinish(i)}):n.loop=!0}))})),e.forEach((t=>{this.$terminateSound(t)}))}}class $t{$current;$previous;constructor(){this.$current=[],this.$previous=[]}$hasCollisionPrevious(t,e){return void 0!==this.$previous.find((([i,s])=>t===i&&e===s))}tick(t){const e=[],i=[],s=[],n=[];t.actors.forEach((t=>{if(!1!==t.hasCollider())switch(t.collider.type){case l:i.push(t);break;case m:s.push(t);break;case p:n.push(t)}}));const o=[...n,...s];0!==o.length&&(i.forEach((t=>{const i=t.collider.boundaries.clone().translate(t.translation),s=new L(i.center,i.center);o.forEach((i=>{const n=i.collider.boundaries.clone().translate(i.translation),o=L.distanceManhattan(s,n);e.push({$distance:o,$dynamic:t,$inert:i})}))})),e.sort(((t,e)=>t.$distance-e.$distance)),e.forEach((e=>{const{$dynamic:i,$inert:s}=e;if(!1===t.hasActor(i))return;if(!1===t.hasActor(s))return;const n=i.collider.boundaries.clone().translate(i.translation),o=s.collider.boundaries.clone().translate(s.translation),a=L.overlapX(n,o);if(a<=0)return;const r=L.overlapY(n,o);if(r<=0)return;this.$current.push([i,s]);const h=Math.sign(s.translation.x-i.translation.x),c=Math.sign(s.translation.y-i.translation.y),$=a<=r,d=r<=a;if(!1===i.collider.traversable&&!1===s.collider.traversable){const t=new it($?-h*a:0,d?-c*r:0);i.translate(t)}const u=!0===$&&1===h,l=!0===d&&1===c,m=!0===d&&-1===c,p=!0===$&&-1===h;!1===this.$hasCollisionPrevious(i,s)&&(i.onCollideEnter({$actor:s,$east:u,$north:l,$south:m,$west:p}),s.onCollideEnter({$actor:i,$east:p,$north:m,$south:l,$west:u})),i.onCollide({$actor:s,$east:u,$north:l,$south:m,$west:p}),s.onCollide({$actor:i,$east:p,$north:m,$south:l,$west:u})})),this.$previous.filter((([t,e])=>void 0===this.$current.find((([i,s])=>i===t&&s===e)))).forEach((([t,e])=>{t.onCollideLeave(e),e.onCollideLeave(t)})),this.$previous=[...this.$current],this.$current=[])}}class dt{$container;$events;$initiated;$inputs;$inputsAnalog;constructor({$container:t}){this.$container=t,this.$events=[],this.$initiated=!1,this.$inputs={},this.$inputsAnalog={}}$stack(t){t.preventDefault(),this.$events.push(t)}getInput(t){const e=this.$inputs[t];return void 0!==e&&e}getInputAnalog(t){const e=this.$inputsAnalog[t];return void 0===e?0:e}initiate(){!0!==this.$initiated&&(window.addEventListener("blur",this.$stack.bind(this)),window.addEventListener("contextmenu",this.$stack.bind(this)),window.addEventListener("gamepadanalog",this.$stack.bind(this)),window.addEventListener("gamepadconnect",this.$stack.bind(this)),window.addEventListener("gamepaddown",this.$stack.bind(this)),window.addEventListener("gamepadup",this.$stack.bind(this)),this.$container.addEventListener("keydown",this.$stack.bind(this)),this.$container.addEventListener("keyup",this.$stack.bind(this)),this.$initiated=!0)}terminate(){!1!==this.$initiated&&(window.removeEventListener("blur",this.$stack.bind(this)),window.removeEventListener("contextmenu",this.$stack.bind(this)),window.removeEventListener("gamepadanalog",this.$stack.bind(this)),window.removeEventListener("gamepadconnect",this.$stack.bind(this)),window.removeEventListener("gamepaddown",this.$stack.bind(this)),window.removeEventListener("gamepadup",this.$stack.bind(this)),this.$container.removeEventListener("keydown",this.$stack.bind(this)),this.$container.removeEventListener("keyup",this.$stack.bind(this)),this.$initiated=!1)}tick(){for(!1===this.$initiated&&this.initiate();this.$events.length>0;){const t=this.$events.shift();"blur"===t.type?(this.$inputs={},this.$inputsAnalog={}):t instanceof at&&"gamepadanalog"===t.type?this.$inputsAnalog[t.code]=t.value:t instanceof rt&&"gamepaddown"===t.type?void 0===this.$inputs[t.code]&&(this.$inputs[t.code]=!0):t instanceof rt&&"gamepadup"===t.type?void 0!==this.$inputs[t.code]&&delete this.$inputs[t.code]:t instanceof KeyboardEvent&&"keydown"===t.type?void 0===this.$inputs[t.code]&&(this.$inputs[t.code]=!0):t instanceof KeyboardEvent&&"keyup"===t.type&&void 0!==this.$inputs[t.code]&&delete this.$inputs[t.code]}}}class ut{static UNITTEXTURE0=0;static UNITTEXTURE1=1;static UNITTEXTURE2=2;$bufferPosition;$cache;$canvas;$color;$container;$context;$indices;$initiated;$locationsAttribute;$locationsUniform;$mappingBuffersUv;$program;$resizeOberver;$resolution;$textureColorDefault;$textureOpacityDefault;constructor({$color:t=new st(0,0,0),$container:e,$resolution:i}){this.$color=t,this.$container=e,this.$resolution=i,this.$cache=new Map,this.$canvas=document.createElement("canvas"),this.$canvas.style.width="100%",this.$canvas.style.height="100%",this.$canvas.style.display="block",this.$canvas.style.outline="0",this.$canvas.style.imageRendering="pixelated",this.$context=this.$canvas.getContext("webgl2",{antialias:!1}),e.appendChild(this.$canvas),this.$resize(),this.$initiated=!1}$createBufferPositions(){const t=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ARRAY_BUFFER,t),this.$context.bufferData(this.$context.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]),this.$context.STATIC_DRAW),this.$bufferPosition=t}$createBufferUvsOnce(t){if(void 0!==this.$mappingBuffersUv[t.frameSourceSerialized])return;const e=t.frameSource,i=[e.minimum.x,e.maximum.y,e.minimum.x,e.minimum.y,e.maximum.x,e.minimum.y,e.maximum.x,e.maximum.y],s=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ARRAY_BUFFER,s),this.$context.bufferData(this.$context.ARRAY_BUFFER,new Float32Array(i),this.$context.STATIC_DRAW),this.$mappingBuffersUv[t.frameSourceSerialized]=s}$createIndices(){const t=[0,1,2,3],e=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ELEMENT_ARRAY_BUFFER,e),this.$context.bufferData(this.$context.ELEMENT_ARRAY_BUFFER,new Uint32Array(t),this.$context.STATIC_DRAW),this.$indices=t.length}$createLocationsAttribute(t,e){Object.keys(e.attributes).forEach((e=>{this.$locationsAttribute[e]=this.$context.getAttribLocation(t,e)}))}$createLocationsUniform(t,e){Object.keys(e.uniforms).forEach((e=>{this.$locationsUniform[e]=this.$context.getUniformLocation(t,e)}))}$createProgram(t){const e=this.$context.createShader(this.$context.VERTEX_SHADER);this.$context.shaderSource(e,t.sourceVertex),this.$context.compileShader(e);const i=this.$context.createShader(this.$context.FRAGMENT_SHADER);this.$context.shaderSource(i,t.sourceFragment),this.$context.compileShader(i),this.$program=this.$context.createProgram(),this.$context.attachShader(this.$program,e),this.$context.attachShader(this.$program,i),this.$context.linkProgram(this.$program)}$createTexture(t,e){const i=this.$context.createTexture();return this.$context.activeTexture(e),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_MIN_FILTER,this.$context.NEAREST),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_MAG_FILTER,this.$context.NEAREST),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_WRAP_S,this.$context.CLAMP_TO_EDGE),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_WRAP_T,this.$context.CLAMP_TO_EDGE),this.$context.texImage2D(this.$context.TEXTURE_2D,0,this.$context.RGBA,this.$context.RGBA,this.$context.UNSIGNED_BYTE,t),i}$createTextureDefault(t,e){const i=this.$context.createTexture();return this.$context.activeTexture(this.$context.TEXTURE0+e),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$context.texImage2D(this.$context.TEXTURE_2D,0,this.$context.RGBA,1,1,0,this.$context.RGBA,this.$context.UNSIGNED_BYTE,new Uint8Array([t.x,t.y,t.z,255])),i}$loadTexture(t,e){return new Promise((i=>{t.blob().then((t=>createImageBitmap(t))).then((s=>{const n=this.$createTexture(s,e);this.$cache.set(t.url,n),i(n)}))}))}$prepareTexture(t,e){!0!==this.$cache.has(t)&&(this.$cache.set(t,void 0),fetch(t).then((t=>this.$loadTexture(t,e))))}$onBeforeUnload(){this.$context.getExtension("WEBGL_lose_context").loseContext()}$resetCanvas(t,e){this.$context.clearColor(this.$color.x,this.$color.y,this.$color.z,1),this.$context.clearDepth(1),this.$context.viewport(0,0,t,e),this.$context.clear(this.$context.COLOR_BUFFER_BIT|this.$context.DEPTH_BUFFER_BIT)}$resize(){const t=this.$resolution.x,e=this.$resolution.y,i=Math.max(t,Math.floor(e*this.$canvas.clientWidth/this.$canvas.clientHeight)),s=Math.max(e,Math.floor(t*this.$canvas.clientHeight/this.$canvas.clientWidth));this.$canvas.setAttribute("width",""+2*Math.floor(i/2)),this.$canvas.setAttribute("height",""+2*Math.floor(s/2))}$sendAttribute(t,e,i){if(void 0!==t.attributes[e])switch(t.attributes[e]){case"vec2":{this.$context.bindBuffer(this.$context.ARRAY_BUFFER,i);const t=this.$locationsAttribute[e];this.$context.vertexAttribPointer(t,2,this.$context.FLOAT,!1,0,0),this.$context.enableVertexAttribArray(t);break}case"vec3":{this.$context.bindBuffer(this.$context.ARRAY_BUFFER,i);const t=this.$locationsAttribute[e];this.$context.vertexAttribPointer(t,3,this.$context.FLOAT,!1,0,0),this.$context.enableVertexAttribArray(t);break}}}$sendUniform(t,e,i){if(void 0!==t.uniforms[e])switch(t.uniforms[e]){case"bool":case"int":case"sampler2D":this.$context.uniform1i(this.$locationsUniform[e],i);break;case"bool[]":case"int[]":this.$context.uniform1iv(this.$locationsUniform[e],i);break;case"float":this.$context.uniform1f(this.$locationsUniform[e],i);break;case"float[]":this.$context.uniform1fv(this.$locationsUniform[e],i);break;case"mat4":case"mat4[]":this.$context.uniformMatrix4fv(this.$locationsUniform[e],!1,i);break;case"vec2":case"vec2[]":this.$context.uniform2fv(this.$locationsUniform[e],i);break;case"vec3":case"vec3[]":this.$context.uniform3fv(this.$locationsUniform[e],i)}}hasAssetLoaded(t){return!0===this.$cache.has(t)}initiate(){!0!==this.$initiated&&(this.$indices=0,this.$locationsAttribute={},this.$locationsUniform={},this.$mappingBuffersUv={},this.$context.frontFace(this.$context.CW),this.$context.enable(this.$context.CULL_FACE),this.$context.cullFace(this.$context.BACK),this.$context.enable(this.$context.BLEND),this.$context.blendFunc(this.$context.SRC_ALPHA,this.$context.ONE_MINUS_SRC_ALPHA),this.$createProgram(N),this.$context.useProgram(this.$program),this.$createLocationsUniform(this.$program,N),this.$createLocationsAttribute(this.$program,N),this.$createBufferPositions(),this.$createIndices(),this.$textureColorDefault=this.$createTextureDefault(new st(127,127,127),ut.UNITTEXTURE1),this.$textureOpacityDefault=this.$createTextureDefault(new st(255,255,255),ut.UNITTEXTURE2),this.$resizeOberver=new ResizeObserver(this.$resize.bind(this)),this.$resizeOberver.observe(this.$container),window.addEventListener("beforeunload",this.$onBeforeUnload.bind(this)),this.$initiated=!0)}loadTexture(t){return!1===this.$initiated&&this.initiate(),!0===this.$cache.has(t.url)?new Promise((e=>{e(this.$cache.get(t.url))})):(this.$cache.set(t.url,void 0),this.$loadTexture(t,this.$context.TEXTURE0+ut.UNITTEXTURE0))}setColor(t){this.$color=t}setResolution(t){this.$resolution=t.clone(),this.$resize()}terminate(){!1!==this.$initiated&&(this.$resizeOberver.disconnect(),window.removeEventListener("beforeunload",this.$onBeforeUnload.bind(this)),this.$initiated=!1)}tick(t){!1===this.$initiated&&this.initiate(),this.$resetCanvas(this.$canvas.width,this.$canvas.height),this.$sendUniform(N,"uniformAspect",[this.$canvas.width,this.$canvas.height]),this.$sendUniform(N,"uniformTranslationPointOfView",[Math.floor(t.pointOfView.translation.x),Math.floor(t.pointOfView.translation.y)]),this.$sendAttribute(N,"attributePosition",this.$bufferPosition);const e=[...t.actors];e.sort(((t,e)=>t.zIndex-e.zIndex)),e.forEach((t=>{if(!1===t.hasSprite())return;let e=this.$textureColorDefault;this.$prepareTexture(t.sprite.textureColor,this.$context.TEXTURE0+ut.UNITTEXTURE1),void 0!==this.$cache.get(t.sprite.textureColor)&&(e=this.$cache.get(t.sprite.textureColor)),this.$context.activeTexture(this.$context.TEXTURE0+ut.UNITTEXTURE1),this.$context.bindTexture(this.$context.TEXTURE_2D,e),this.$sendUniform(N,"uniformTextureColor",ut.UNITTEXTURE1);let i=this.$textureOpacityDefault;void 0!==t.sprite.textureOpacity&&(this.$prepareTexture(t.sprite.textureOpacity,this.$context.TEXTURE0+ut.UNITTEXTURE2),void 0!==this.$cache.get(t.sprite.textureOpacity)&&(i=this.$cache.get(t.sprite.textureOpacity))),this.$context.activeTexture(this.$context.TEXTURE0+ut.UNITTEXTURE2),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$sendUniform(N,"uniformTextureOpacity",ut.UNITTEXTURE2),this.$sendUniform(N,"uniformSize",[t.sprite.sizeTarget.x,t.sprite.sizeTarget.y]),this.$sendUniform(N,"uniformTranslation",[Math.floor(t.translation.x),Math.floor(t.translation.y)]),this.$createBufferUvsOnce(t.sprite),this.$sendAttribute(N,"attributeUvmapping",this.$mappingBuffersUv[t.sprite.frameSourceSerialized]),this.$context.drawElements(this.$context.TRIANGLE_FAN,this.$indices,this.$context.UNSIGNED_INT,0)}))}}class lt{static DELAYVIBRATIONEND=1e3;$mappingVibrationsPlaying;constructor(){this.$mappingVibrationsPlaying=new Map}terminate(){window.dispatchEvent(new rt("gamepadvibrate",S))}tick({$stage:t,$timetick:e}){const i=Array.from(this.$mappingVibrationsPlaying.keys());t.actors.forEach((t=>{const s=[];t.vibrations.forEach((t=>{if(!1===this.$mappingVibrationsPlaying.has(t))return void this.$mappingVibrationsPlaying.set(t,0);const n=this.$mappingVibrationsPlaying.get(t)+e;n>=t.duration?s.push(t):(this.$mappingVibrationsPlaying.set(t,n),Z(t,i))})),s.forEach((e=>{t.removeVibration(e)}))})),i.forEach((t=>{this.$mappingVibrationsPlaying.delete(t)}));const s=Array.from(this.$mappingVibrationsPlaying.keys());let n=0,o=0;s.forEach((t=>{n=Math.max(n,t.intensityFrequencyHigh),o=Math.max(o,t.intensityFrequencyLow)})),window.dispatchEvent(new ot("gamepadvibrate",C,{$duration:lt.DELAYVIBRATIONEND,$intensityFrequencyHigh:n,$intensityFrequencyLow:o}))}}new class{$indexLastConnected;$stateGamepad;$unloaded;constructor(){this.$stateGamepad={},this.$unloaded=!1,[...u,...d.flat()].forEach((t=>{this.$stateGamepad[t]=!1})),window.addEventListener("beforeunload",this.$onBeforeUnload.bind(this)),window.addEventListener("gamepadconnected",this.$onConnect.bind(this)),window.addEventListener("gamepaddisconnected",this.$onDisconnect.bind(this)),window.addEventListener("gamepadvibrate",this.$onVibrate.bind(this)),window.requestAnimationFrame(this.$update.bind(this))}$onBeforeUnload(){this.$unloaded=!0;const t=navigator.getGamepads()[this.$indexLastConnected];void 0!==t&&void 0!==t.vibrationActuator&&t.vibrationActuator.reset()}$onConnect(t){"standard"===t.gamepad.mapping&&(Object.entries(this.$stateGamepad).forEach((([t,e])=>{!0===e&&(this.$stateGamepad[t]=!1,window.dispatchEvent(new rt("gamepadup",t)))})),this.$indexLastConnected=t.gamepad.index,window.dispatchEvent(new rt("gamepadconnect","Connected")))}$onDisconnect(t){t.gamepad.index===this.$indexLastConnected&&(Object.entries(this.$stateGamepad).forEach((([t,e])=>{!0===e&&(this.$stateGamepad[t]=!1,window.dispatchEvent(new rt("gamepadup",t)))})),this.$indexLastConnected=void 0,window.dispatchEvent(new rt("gamepadconnect","Disconnected")))}$onVibrate(t){if(!0===this.$unloaded)return;const e=navigator.getGamepads()[this.$indexLastConnected];void 0!==e&&void 0!==e.vibrationActuator&&(t instanceof rt&&"VibrateEnd"===t.code?e.vibrationActuator.reset():t instanceof ot&&"VibrateStart"===t.code&&e.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:t.data.$duration,strongMagnitude:t.data.$intensityFrequencyLow,weakMagnitude:t.data.$intensityFrequencyHigh}))}$update(){const t=navigator.getGamepads()[this.$indexLastConnected];t instanceof Gamepad&&(u.forEach(((e,i)=>{const s=t.buttons[i];!0===s.pressed?(!1===this.$stateGamepad[e]&&(this.$stateGamepad[e]=!0),window.dispatchEvent(new rt("gamepaddown",e)),window.dispatchEvent(new at("gamepadanalog",e,s.value))):!0===this.$stateGamepad[e]&&(this.$stateGamepad[e]=!1,window.dispatchEvent(new rt("gamepadup",e)))})),t.axes.forEach(((t,e)=>{const[i,s]=d[e];t<=-.5?(!0===this.$stateGamepad[s]&&(this.$stateGamepad[s]=!1,window.dispatchEvent(new rt("gamepadup",s))),this.$stateGamepad[i]=!0,window.dispatchEvent(new rt("gamepaddown",i)),window.dispatchEvent(new at("gamepadanalog",i,(t-.5*Math.sign(t))/.5))):t>=.5?(!0===this.$stateGamepad[i]&&(this.$stateGamepad[i]=!1,window.dispatchEvent(new rt("gamepadup",i))),this.$stateGamepad[s]=!0,window.dispatchEvent(new rt("gamepaddown",s)),window.dispatchEvent(new at("gamepadanalog",s,(t-.5*Math.sign(t))/.5))):(!0===this.$stateGamepad[i]&&(this.$stateGamepad[i]=!1,window.dispatchEvent(new rt("gamepadup",i))),!0===this.$stateGamepad[s]&&(this.$stateGamepad[s]=!1,window.dispatchEvent(new rt("gamepadup",s))))}))),window.requestAnimationFrame(this.$update.bind(this))}}}},o={};function a(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={exports:{}};return n[t](i,i.exports,a),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(n,o,a)=>{var r;a&&((r=[]).d=-1);var h,c,$,d=new Set,u=n.exports,l=new Promise(((t,e)=>{$=e,c=t}));l[e]=u,l[t]=t=>(r&&t(r),d.forEach(t),l.catch((t=>{}))),n.exports=l,o((n=>{var o;h=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var o=[];o.d=0,n.then((t=>{a[e]=t,s(o)}),(t=>{a[i]=t,s(o)}));var a={};return a[t]=t=>t(o),a}}var r={};return r[t]=t=>{},r[e]=n,r})))(n);var a=()=>h.map((t=>{if(t[i])throw t[i];return t[e]})),c=new Promise((e=>{(o=()=>e(a)).r=0;var i=t=>t!==r&&!d.has(t)&&(d.add(t),t&&!t.d&&(o.r++,t.push(o)));h.map((e=>e[t](i)))}));return o.r?c:a()}),(t=>(t?$(l[i]=t):c(u),s(r)))),r&&r.d<0&&(r.d=0)},a.d=(t,e)=>{for(var i in e)a.o(e,i)&&!a.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},a.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;a.g.importScripts&&(t=a.g.location+"");var e=a.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&(!t||!/^http(s?):/.test(t));)t=i[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),a.p=t})(),a(864)})();
//# sourceMappingURL=bundle.js.map