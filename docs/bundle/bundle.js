(()=>{"use strict";var t,e,i,s,n={864:(t,e,i)=>{i.a(t,(async(t,e)=>{try{var s=i(616),n=i(497);s.fd.activate();const t=new s.N$({$container:document.body});t.initiate(60),await t.preloadStage(n.A),t.createStage(n.A),e()}catch(t){e(t)}}),1)},497:(t,e,i)=>{i.d(e,{A:()=>T});var s=i(616);function n({$aseprite:t,$loop:e=!1,$tag:i}){class n extends s.Ag{$timeline;$createTimeline(){const n=t.getSprites(i);if(0===n.size)return new s.Kf;let o=0;const r=Array.from(n.entries()).map((([t,e])=>{const i=new s.a3({$onEnter:()=>{this.setSprite(t)},$timecode:o});return o+=e,i}));return!0===e&&r.push(new s.a3({$onEnter:t=>{t.seekTimecode(0)},$timecode:o})),new s.Kf(r)}onCreate(){this.$timeline=this.$createTimeline(),this.$timeline.seekTimecode(0)}onTick(t){this.$timeline.tick(t)}}return n}function o(t){class e extends s.SJ{static preloadables=[t.textureColor]}return e}class r{$sprites;$tags;$textureColor;get textureColor(){return this.$textureColor}constructor(t,e){this.$textureColor=t,this.$sprites=new Map,e.frames.forEach((i=>{const n=new s.kx({$frameSource:new s.F5(new s.I9(i.frame.x/e.meta.size.w,i.frame.y/e.meta.size.h),new s.I9((i.frame.x+i.frame.w)/e.meta.size.w,(i.frame.y+i.frame.h)/e.meta.size.h)),$sizeTarget:new s.I9(i.frame.w,i.frame.h),$textureColor:t});this.$sprites.set(n,i.duration)})),this.$tags=new Map,e.meta.frameTags.forEach((t=>{const e=Array.from(this.$sprites.entries()).slice(t.from,t.to+1);this.$tags.set(t.name,new Map(e))}))}getSprites(t){if(0===this.$tags.size)return new Map;if(!1===this.$tags.has(t)){const t=Array.from(this.$tags.keys())[0];return this.$tags.get(t)}return this.$tags.get(t)}}const a=new r(i.p+"3cddbde68c157c223ad2.png",JSON.parse('{"frames":[{"filename":"disabled#001@button-continue-64x16.aseprite","frame":{"x":0,"y":0,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"idle#001@button-continue-64x16.aseprite","frame":{"x":0,"y":16,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"focus#001@button-continue-64x16.aseprite","frame":{"x":0,"y":32,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#001@button-continue-64x16.aseprite","frame":{"x":0,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#002@button-continue-64x16.aseprite","frame":{"x":64,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100}],"meta":{"app":"https://www.aseprite.org/","version":"1.3.8.1-x64","image":"button-continue-64x16.png","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1","frameTags":[{"name":"disabled","from":0,"to":0,"direction":"forward","color":"#000000ff"},{"name":"idle","from":1,"to":1,"direction":"forward","color":"#000000ff"},{"name":"focus","from":2,"to":2,"direction":"forward","color":"#000000ff"},{"name":"activated","from":3,"to":4,"direction":"forward","color":"#000000ff"}]}}'));class h extends(s.xI.ActorWithPreloadables([o(a)])){$spritesheet;$animateSpritesheet(t){this.stage.removeActor(this.$spritesheet),this.$spritesheet=this.stage.createActor(n({$aseprite:a,$loop:!0,$tag:t})).setVisible(this.visible).setZIndex(this.zIndex).translate(this.translation)}actionActivate(){this.$animateSpritesheet("activated")}actionDisable(){this.$animateSpritesheet("disabled")}actionFocus(){this.$animateSpritesheet("focus")}actionRest(){this.$animateSpritesheet("idle")}onBeforeRemove(){this.stage.removeActor(this.$spritesheet)}onCreate(){this.actionRest()}onSetVisible(t){this.$spritesheet.setVisible(t)}onSetZIndex(t){this.$spritesheet.setZIndex(t)}onTranslate(t){this.$spritesheet.translate(t)}}const c=h,$=new r(i.p+"df4963921b44b9021f8f.png",JSON.parse('{"frames":[{"filename":"disabled#001@button-dlc-64x16.aseprite","frame":{"x":0,"y":0,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"idle#001@button-dlc-64x16.aseprite","frame":{"x":0,"y":16,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"focus#001@button-dlc-64x16.aseprite","frame":{"x":0,"y":32,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#001@button-dlc-64x16.aseprite","frame":{"x":0,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#002@button-dlc-64x16.aseprite","frame":{"x":64,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100}],"meta":{"app":"https://www.aseprite.org/","version":"1.3.8.1-x64","image":"button-dlc-64x16.png","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1","frameTags":[{"name":"disabled","from":0,"to":0,"direction":"forward","color":"#000000ff"},{"name":"idle","from":1,"to":1,"direction":"forward","color":"#000000ff"},{"name":"focus","from":2,"to":2,"direction":"forward","color":"#000000ff"},{"name":"activated","from":3,"to":4,"direction":"forward","color":"#000000ff"}]}}'));class u extends(s.xI.ActorWithPreloadables([o($)])){$spritesheet;$animateSpritesheet(t){this.stage.removeActor(this.$spritesheet),this.$spritesheet=this.stage.createActor(n({$aseprite:$,$loop:!0,$tag:t})).setVisible(this.visible).setZIndex(this.zIndex).translate(this.translation)}actionActivate(){this.$animateSpritesheet("activated")}actionDisable(){this.$animateSpritesheet("disabled")}actionFocus(){this.$animateSpritesheet("focus")}actionRest(){this.$animateSpritesheet("idle")}onBeforeRemove(){this.stage.removeActor(this.$spritesheet)}onCreate(){this.actionRest()}onSetVisible(t){this.$spritesheet.setVisible(t)}onSetZIndex(t){this.$spritesheet.setZIndex(t)}onTranslate(t){this.$spritesheet.translate(t)}}const d=u,l=new r(i.p+"7190e8be62a7ac1ed498.png",JSON.parse('{"frames":[{"filename":"disabled#001@button-new-game-64x16.aseprite","frame":{"x":0,"y":0,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"idle#001@button-new-game-64x16.aseprite","frame":{"x":0,"y":16,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"focus#001@button-new-game-64x16.aseprite","frame":{"x":0,"y":32,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#001@button-new-game-64x16.aseprite","frame":{"x":0,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#002@button-new-game-64x16.aseprite","frame":{"x":64,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100}],"meta":{"app":"https://www.aseprite.org/","version":"1.3.8.1-x64","image":"button-new-game-64x16.png","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1","frameTags":[{"name":"disabled","from":0,"to":0,"direction":"forward","color":"#000000ff"},{"name":"idle","from":1,"to":1,"direction":"forward","color":"#000000ff"},{"name":"focus","from":2,"to":2,"direction":"forward","color":"#000000ff"},{"name":"activated","from":3,"to":4,"direction":"forward","color":"#000000ff"}]}}'));class m extends(s.xI.ActorWithPreloadables([o(l)])){$spritesheet;$animateSpritesheet(t){this.stage.removeActor(this.$spritesheet),this.$spritesheet=this.stage.createActor(n({$aseprite:l,$loop:!0,$tag:t})).setVisible(this.visible).setZIndex(this.zIndex).translate(this.translation)}actionActivate(){this.$animateSpritesheet("activated")}actionDisable(){this.$animateSpritesheet("disabled")}actionFocus(){this.$animateSpritesheet("focus")}actionRest(){this.$animateSpritesheet("idle")}onBeforeRemove(){this.stage.removeActor(this.$spritesheet)}onCreate(){this.actionRest()}onSetVisible(t){this.$spritesheet.setVisible(t)}onSetZIndex(t){this.$spritesheet.setZIndex(t)}onTranslate(t){this.$spritesheet.translate(t)}}const p=m,f=new r(i.p+"c3ff0de4fe5f7a55683f.png",JSON.parse('{"frames":[{"filename":"disabled#001@button-quit-64x16.aseprite","frame":{"x":0,"y":0,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"idle#001@button-quit-64x16.aseprite","frame":{"x":0,"y":16,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"focus#001@button-quit-64x16.aseprite","frame":{"x":0,"y":32,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#001@button-quit-64x16.aseprite","frame":{"x":0,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100},{"filename":"activated#002@button-quit-64x16.aseprite","frame":{"x":64,"y":48,"w":64,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":64,"h":16},"sourceSize":{"w":64,"h":16},"duration":100}],"meta":{"app":"https://www.aseprite.org/","version":"1.3.8.1-x64","image":"button-quit-64x16.png","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1","frameTags":[{"name":"disabled","from":0,"to":0,"direction":"forward","color":"#000000ff"},{"name":"idle","from":1,"to":1,"direction":"forward","color":"#000000ff"},{"name":"focus","from":2,"to":2,"direction":"forward","color":"#000000ff"},{"name":"activated","from":3,"to":4,"direction":"forward","color":"#000000ff"}]}}'));class x extends(s.xI.ActorWithPreloadables([o(f)])){$spritesheet;$animateSpritesheet(t){this.stage.removeActor(this.$spritesheet),this.$spritesheet=this.stage.createActor(n({$aseprite:f,$loop:!0,$tag:t})).setVisible(this.visible).setZIndex(this.zIndex).translate(this.translation)}actionActivate(){this.$animateSpritesheet("activated")}actionDisable(){this.$animateSpritesheet("disabled")}actionFocus(){this.$animateSpritesheet("focus")}actionRest(){this.$animateSpritesheet("idle")}onBeforeRemove(){this.stage.removeActor(this.$spritesheet)}onCreate(){this.actionRest()}onSetVisible(t){this.$spritesheet.setVisible(t)}onSetZIndex(t){this.$spritesheet.setZIndex(t)}onTranslate(t){this.$spritesheet.translate(t)}}const g=x,v=i.p+"4378e9fa9e4ca0b2781ec67b69c8af0f.mp3",w=i.p+"f2651d13f4de25921433f7a8c179abd0.mp3";class b extends(s.xI.ActorWithPreloadables([c,d,p,g,s.xI.PreloadableSound(v),s.xI.PreloadableSound(w)])){$buttonContinue;$buttonNewGame;$buttonDlc;$buttonQuit;$finiteStateMachineMenu;onBeforeRemove(){this.stage.removeActor(this.$buttonContinue),this.stage.removeActor(this.$buttonNewGame),this.stage.removeActor(this.$buttonDlc),this.stage.removeActor(this.$buttonQuit)}onCreate(){this.$buttonContinue=this.stage.createActor(c).translate(new s.I9(0,36)),this.$buttonNewGame=this.stage.createActor(p).translate(new s.I9(0,12)),this.$buttonDlc=this.stage.createActor(d).translate(new s.I9(0,-12)),this.$buttonQuit=this.stage.createActor(g).translate(new s.I9(0,-36)),!0!==s.O3.get("continue")&&this.$buttonContinue.actionDisable(),this.$buttonDlc.actionDisable();const t=200,e=()=>this.engine.getInput(s.nC.dT.Fm)||this.engine.getInput(s.nC.Ze.A)||this.engine.getInput(s.nC.Ze.d3),i=()=>this.engine.getInput(s.nC.dT.UP)||this.engine.getInput(s.nC.Ze.UP)||this.engine.getInput(s.nC.Ze.nR),n=()=>this.engine.getInput(s.nC.dT.PX)||this.engine.getInput(s.nC.Ze.PX)||this.engine.getInput(s.nC.Ze.Yx);this.$finiteStateMachineMenu=new s.EF([{$state:"INITIATE",$transitions:[{$state:"CONTINUESELECTED",$condition:({$timer:t})=>t>=800&&!0===s.O3.get("continue")},{$state:"NEWGAMESELECTED",$condition:({$timer:t})=>t>=800&&!0!==s.O3.get("continue")}]},{$state:"CONTINUESELECTED",$onEnter:({$previous:t})=>{this.$buttonContinue.actionFocus(),"INITIATE"!==t&&"CONTINUEACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>this.$buttonContinue.actionRest(),$transitions:[{$state:"CONTINUEACTIVATED",$condition:()=>!0===e()},{$state:"NEWGAMESELECTED",$condition:({$timer:s})=>s>=t&&!0===n()&&!1===i()&&!1===e()}]},{$state:"CONTINUEACTIVATED",$onEnter:()=>{this.$buttonContinue.actionActivate(),this.addSound(new s.AB({$audio:w,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:()=>{this.$buttonContinue.actionRest(),console.log("Continue")},$transitions:[{$state:"CONTINUESELECTED",$condition:({$timer:t})=>t>=800&&!1===e()}]},{$state:"NEWGAMESELECTED",$onEnter:({$previous:t})=>{this.$buttonNewGame.actionFocus(),"INITIATE"!==t&&"NEWGAMEACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>this.$buttonNewGame.actionRest(),$transitions:[{$state:"NEWGAMEACTIVATED",$condition:()=>!0===e()},{$state:"CONTINUESELECTED",$condition:({$timer:o})=>!0===s.O3.get("continue")&&o>=t&&!0===i()&&!1===n()&&!1===e()},{$state:"QUITSELECTED",$condition:({$timer:s})=>s>=t&&!0===n()&&!1===i()&&!1===e()}]},{$state:"NEWGAMEACTIVATED",$onEnter:()=>{this.$buttonNewGame.actionActivate(),this.addSound(new s.AB({$audio:w,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:()=>{this.$buttonNewGame.actionRest(),!0!==s.O3.get("continue")&&(this.$buttonContinue.actionRest(),s.O3.set("continue",!0)),console.log("New Game")},$transitions:[{$state:"NEWGAMESELECTED",$condition:({$timer:t})=>t>=800&&!1===e()}]},{$state:"QUITSELECTED",$onEnter:({$previous:t})=>{this.$buttonQuit.actionFocus(),"QUITACTIVATED"!==t&&this.addSound(new s.AB({$audio:v,$volume:.5}))},$onLeave:()=>this.$buttonQuit.actionRest(),$transitions:[{$state:"QUITACTIVATED",$condition:()=>!0===e()},{$state:"NEWGAMESELECTED",$condition:({$timer:s})=>s>=t&&!0===i()&&!1===n()&&!1===e()}]},{$state:"QUITACTIVATED",$onEnter:()=>{this.$buttonQuit.actionActivate(),this.addSound(new s.AB({$audio:w,$volume:.5})),this.addVibration(new s.Hx({$duration:100,$intensityFrequencyHigh:1,$intensityFrequencyLow:0}))},$onLeave:async()=>{this.$buttonQuit.actionRest(),!0===s.O3.get("continue")&&(this.$buttonContinue.actionDisable(),s.O3.set("continue",!1)),console.log("Quit"),window.close(),window.queueMicrotask((async()=>{this.engine.terminate(),await s.Sf.sleep(1e3),this.engine.initiate(60),await this.engine.preloadStage(T),this.engine.createStage(T)}))},$transitions:[{$state:"QUITSELECTED",$condition:({$timer:t})=>t>=1200&&!1===e()}]}]),this.$finiteStateMachineMenu.initiate("INITIATE")}onSetVisible(t){this.$buttonContinue.setVisible(t),this.$buttonNewGame.setVisible(t),this.$buttonDlc.setVisible(t),this.$buttonQuit.setVisible(t)}onSetZIndex(t){this.$buttonContinue.setZIndex(t),this.$buttonNewGame.setZIndex(t),this.$buttonDlc.setZIndex(t),this.$buttonQuit.setZIndex(t)}onTick(t){this.$finiteStateMachineMenu.update(t)}onTranslate(t){this.$buttonContinue.translate(t),this.$buttonNewGame.translate(t),this.$buttonDlc.translate(t),this.$buttonQuit.translate(t)}}const y=b;class E extends(s.xI.StageWithPreloadables([y])){onCreate(){this.engine.setColor(new s.Pq(27/255,36/255,71/255)),this.engine.setResolution(new s.I9(480,360)),this.createActor(y)}}const T=E},616:(t,e,i)=>{i.d(e,{F5:()=>F,Ag:()=>L,Ig:()=>s,Z5:()=>n,Jo:()=>O,nC:()=>a,N$:()=>P,_p:()=>ht,wc:()=>ct,IY:()=>$t,fd:()=>lt,xI:()=>c,EF:()=>M,FZ:()=>_,hO:()=>h,SJ:()=>U,O3:()=>$,Mt:()=>G,AB:()=>q,kx:()=>X,BI:()=>k,iQ:()=>Q,$V:()=>mt,mr:()=>pt,kd:()=>ft,Mh:()=>xt,Ce:()=>gt,c0:()=>vt,Kf:()=>j,a3:()=>J,Sf:()=>u,I9:()=>ot,Pq:()=>rt,Hx:()=>at});var s={};i.r(s),i.d(s,{u5:()=>d,g5:()=>l,DU:()=>m});var n={};i.r(n),i.d(n,{Ok:()=>p,WG:()=>f,eg:()=>x,Bg:()=>g});var o={};i.r(o),i.d(o,{A:()=>v,PX:()=>y,Yx:()=>T,nR:()=>E,d3:()=>w,UP:()=>b,xo:()=>S,YX:()=>A});var r={};i.r(r),i.d(r,{PX:()=>R,Fm:()=>C,UP:()=>I});var a={};i.r(a),i.d(a,{Ze:()=>o,dT:()=>r});var h={};i.r(h),i.d(h,{n:()=>z});var c={};i.r(c),i.d(c,{ActorWithPreloadables:()=>B,PreloadableSound:()=>D,PreloadableTexture:()=>V,StageWithPreloadables:()=>N});var $={};i.r($),i.d($,{get:()=>Z,has:()=>W,remove:()=>Y,set:()=>H});var u={};i.r(u),i.d(u,{deduplicate:()=>K,extract:()=>tt,frame:()=>et,ready:()=>it,sleep:()=>st,uuid:()=>nt});const d="DYNAMIC",l="KINETIC",m="STATIC",p="audio/mpeg",f="audio/wave",x="image/jpeg",g="image/png",v="ClusterRightButtonBottom",w="ClusterCenterButtonRight",b="ClusterLeftButtonTop",y="ClusterLeftButtonBottom",E="StickLeftUp",T="StickLeftDown",S="VibrateEnd",A="VibrateStart",C="Enter",I="ArrowUp",R="ArrowDown",z=Math.PI/180;class U{static preloadables=[]}class L extends U{$collider;$components;$sounds;$sprite;$stage;$translation;$uuid;$vibrations;$visible;$zIndex;get collider(){return this.$collider}get engine(){return this.stage.engine}get sounds(){return this.$sounds}get sprite(){return this.$sprite}get stage(){return this.$stage}get translation(){return this.$translation}get uuid(){return this.$uuid}get vibrations(){return this.$vibrations}get visible(){return this.$visible}get zIndex(){return this.$zIndex}constructor(t){super(),this.$stage=t,this.$components={},this.$sounds=[],this.$translation=new ot(0,0),this.$uuid=nt(),this.$vibrations=[],this.$visible=!0,this.$zIndex=0}addSound(t){return this.$sounds.push(t),this}addVibration(t){return this.$vibrations.push(t),this}getComponent(t){return this.$components[t]}hasCollider(){return this.$collider instanceof O}hasComponent(t){return!0===this.$components.hasOwnProperty(t)}hasSprite(){return this.$sprite instanceof X}onAfterRemove(){}onBeforeRemove(){}onCollide({$actor:t,$east:e,$north:i,$south:s,$west:n}){}onCollideEnter({$actor:t,$east:e,$north:i,$south:s,$west:n}){}onCollideLeave(t){}onCreate(){}onSetVisible(t){}onSetZIndex(t){}onSoundFinish(t){}onTick(t){}onTranslate(t){}removeSound(t){return tt(t,this.$sounds),this}removeSounds(){return this.$sounds=[],this}removeVibration(t){return tt(t,this.$vibrations),this}removeVibrations(){return this.$vibrations=[],this}setCollider(t){return this.$collider=t,this}setComponent(t,e){return this.$components[t]=e,this}setSprite(t){return this.$sprite=t,this}setVisible(t){return this.$visible=t,this.onSetVisible(t),this}setZIndex(t){return this.$zIndex=t,this.onSetZIndex(t),this}translate(t){const e=t.clone();return this.$translation.add(e),this.onTranslate(e),this}translateTo(t){const e=t.clone().subtract(this.$translation);return this.$translation.add(e),this.onTranslate(e),this}}class k extends U{$actors;$engine;$pointOfView;$uuid;get actors(){return this.$actors}get engine(){return this.$engine}get pointOfView(){return this.$pointOfView}get uuid(){return this.$uuid}constructor(t){super(),this.$engine=t,this.$actors=[],this.$pointOfView=this.createActor(L),this.$uuid=nt()}createActor(t=L){const e=new t(this);return this.$actors.push(e),e.onCreate(),e}hasActor(t){return-1!==this.$actors.indexOf(t)}onCreate(){}removeActor(t){const e=this.$actors.indexOf(t);-1!==e&&(t.onBeforeRemove(),this.$actors.splice(e,1),t.onAfterRemove())}removeActors(){for(;this.$actors.length>0;)this.removeActor(this.$actors[0])}setPointOfView(t){this.$pointOfView=t}}class F{$maximum;$minimum;get center(){return this.minimum.clone().add(this.halfSize)}get halfSize(){return this.size.clone().scale(.5)}get maximum(){return this.$maximum}get minimum(){return this.$minimum}get size(){return this.$maximum.clone().subtract(this.$minimum)}constructor(t,e){this.$maximum=e,this.$minimum=t}static distanceManhattan(t,e){const i=F.distanceX(t,e),s=F.distanceY(t,e);return i>0||s>0?Math.max(i,0)+Math.max(s,0):i+s}static distanceX(t,e){return Math.abs(e.center.x-t.center.x)-(t.halfSize.x+e.halfSize.x)}static distanceY(t,e){return Math.abs(e.center.y-t.center.y)-(t.halfSize.y+e.halfSize.y)}static from(t){return t.clone()}static overlapX(t,e){const i=Math.abs(e.center.x-t.center.x);return t.halfSize.x+e.halfSize.x-i}static overlapY(t,e){const i=Math.abs(e.center.y-t.center.y);return t.halfSize.y+e.halfSize.y-i}clone(){return new F(this.$minimum,this.$maximum)}translate(t){return this.$maximum=this.$maximum.clone().add(t),this.$minimum=this.$minimum.clone().add(t),this}}class O{$boundaries;$traversable;$type;get boundaries(){return this.$boundaries}get traversable(){return this.$traversable}get type(){return this.$type}constructor({$boundaries:t,$traversable:e=!1,$type:i}){this.$boundaries=t,this.$traversable=e,this.$type=i}}class P{$color;$container;$loop;$next;$preloaded;$resolution;$stage;$systemActor;$systemAudio;$systemCollision;$systemInput;$systemRender;$systemVibration;$uuid;get container(){return this.$container}get stage(){return this.$stage}get uuid(){return this.$uuid}constructor({$color:t=new rt(0,0,0),$container:e,$resolution:i=new ot(320,240)}){this.$color=t,this.$container=e,this.$resolution=i,this.$uuid=nt(),this.$loop=new _(this.tick.bind(this)),this.$preloaded=new Set,this.$systemActor=new mt,this.$systemAudio=new pt,this.$systemCollision=new ft,this.$systemInput=new xt({$container:this.$container}),this.$systemRender=new gt({$color:this.$color,$container:this.$container,$resolution:this.$resolution}),this.$systemVibration=new vt}$createStage(t){this.$stage=new t(this),this.$stage.onCreate()}createStage(t){this.$next=t}getInput(t){return this.$systemInput.getInput(t)}getInputAnalog(t){return this.$systemInput.getInputAnalog(t)}hasAssetLoaded(t){return!0===this.$preloaded.has(t)}initiate(t=60){this.$systemInput.initiate(),this.$systemActor.initiate(),this.$systemCollision.initiate(),this.$systemRender.initiate(),this.$systemAudio.initiate(),this.$systemVibration.initiate(),this.$loop.initiate(t)}preloadStage(t){const e=[];return K(t.preloadables).forEach((t=>{if(!0===this.hasAssetLoaded(t))return;if(this.$preloaded.add(t),!0===this.$systemAudio.hasAssetLoaded(t))return;if(!0===this.$systemRender.hasAssetLoaded(t))return;const i=new Promise((e=>{fetch(t).then((t=>{switch(t.headers.get("Content-Type")){case x:case g:this.$systemRender.loadTexture(t).then((t=>{e(t)}));break;case p:case f:this.$systemAudio.loadAudio(t).then((t=>{e(t)}));break;default:e(void 0)}}))}));e.push(i)})),Promise.all(e)}setColor(t){return this.$systemRender.setColor(t)}setResolution(t){return this.$systemRender.setResolution(t)}terminate(){this.$loop.terminate(),this.$createStage(k),this.tick(0),this.$systemInput.terminate(),this.$systemActor.terminate(),this.$systemCollision.terminate(),this.$systemRender.terminate(),this.$systemAudio.terminate(),this.$systemVibration.terminate(),this.$preloaded=new Set}tick(t){if(typeof this.$next==typeof k){const t=this.$next;this.$next=void 0,this.$createStage(t)}void 0!==this.$stage&&(this.$systemInput.tick({$stage:this.$stage,$timetick:t}),this.$systemActor.tick({$stage:this.$stage,$timetick:t}),this.$systemCollision.tick({$stage:this.$stage,$timetick:t}),this.$systemRender.tick({$stage:this.$stage,$timetick:t}),this.$systemAudio.tick({$stage:this.$stage,$timetick:t}),this.$systemVibration.tick({$stage:this.$stage,$timetick:t}))}}function B(t){const e=new Set;t.forEach((t=>{typeof t==typeof U&&t.preloadables.forEach((t=>{!0!==e.has(t)&&e.add(t)}))}));class i extends L{static preloadables=Array.from(e)}return i}function D(t){return class extends U{static preloadables=[t]}}function V(t){return class extends U{static preloadables=[t]}}function N(t){const e=new Set;t.forEach((t=>{typeof t==typeof U&&t.preloadables.forEach((t=>{!0!==e.has(t)&&e.add(t)}))}));class i extends k{static preloadables=Array.from(e)}return i}class M{$initiated;$previous;$state;$states;$timer;constructor(t){this.$initiated=!1,this.$states=new Map,this.$timer=0,t.forEach((t=>{this.$states.set(t.$state,t)}))}initiate(t){!0!==this.$initiated&&(this.$previous=this.$state,this.$state=this.$states.get(t),"function"==typeof this.$state.$onEnter&&this.$state.$onEnter({$previous:void 0}),this.$initiated=!0)}update(t){if(!1!==this.$initiated){this.$timer+=t;for(let t of this.$state.$transitions){let e;void 0!==this.$previous&&(e=this.$previous.$state);const i=this.$state.$state,s=t.$state;if(!0===t.$condition({$previous:e,$timer:this.$timer})){"function"==typeof this.$state.$onLeave&&this.$state.$onLeave({$timer:this.$timer,$next:s}),this.$timer=0,this.$previous=this.$state,this.$state=this.$states.get(s),"function"==typeof this.$state.$onEnter&&this.$state.$onEnter({$previous:i});break}}}}}class _{$handler;$identifier;$timePrevious;$scope;constructor(t,e=window){this.$handler=t,this.$scope=e}$loop(t){const e=performance.now();if(void 0!==this.$timePrevious){const i=e-this.$timePrevious,s=t,n=Math.min(s,i);this.$handler(n)}this.$identifier=this.$scope.requestAnimationFrame(this.$loop.bind(this,t)),this.$timePrevious=e}initiate(t=60){this.$loop(1e3/t)}terminate(){void 0!==this.$identifier&&(this.$scope.cancelAnimationFrame(this.$identifier),this.$timePrevious=void 0)}}class G{static attributes={attributePosition:"vec2",attributeUvmapping:"vec2"};static sourceFragment="precision highp float;uniform sampler2D uniformTextureColor;uniform sampler2D uniformTextureOpacity;uniform vec2 uniformTranslationPointOfView;varying vec2 varyingUvmapping;void main(void) {vec4 colorTextureColor = texture2D(uniformTextureColor, varyingUvmapping);vec4 colorTextureOpacity = texture2D(uniformTextureOpacity, varyingUvmapping);float alpha = colorTextureColor.a * colorTextureOpacity.r;gl_FragColor = vec4(colorTextureColor.rgb, alpha);}";static sourceVertex="attribute vec2 attributePosition;attribute vec2 attributeUvmapping;uniform vec2 uniformAspect;uniform vec2 uniformSize;uniform vec2 uniformTranslation;uniform vec2 uniformTranslationPointOfView;varying vec2 varyingUvmapping;void main(void) {varyingUvmapping = attributeUvmapping;vec2 position = (attributePosition * uniformSize + uniformTranslation);vec2 projection = 2.0 * (position - uniformTranslationPointOfView) / uniformAspect;gl_Position = vec4(projection, 0.0, 1.0);}";static uniforms={uniformAspect:"vec2",uniformSize:"vec2",uniformTextureColor:"sampler2D",uniformTextureOpacity:"sampler2D",uniformTranslation:"vec2",uniformTranslationPointOfView:"vec2"}}class q{$audio;$durationFadeOut;$loop;$volume;get audio(){return this.$audio}get durationFadeOut(){return this.$durationFadeOut}get loop(){return this.$loop}get volume(){return this.$volume}constructor({$audio:t,$durationFadeOut:e=1e3/60,$loop:i=!1,$volume:s=1}){this.$audio=t,this.$durationFadeOut=e,this.$loop=i,this.$volume=s}}class X{$frameSource;$frameSourceSerialized;$sizeTarget;$textureColor;$textureOpacity;get frameSource(){return this.$frameSource}get frameSourceSerialized(){return this.$frameSourceSerialized}get sizeTarget(){return this.$sizeTarget}get textureColor(){return this.$textureColor}get textureOpacity(){return this.$textureOpacity}constructor({$frameSource:t=new F(new ot(0,0),new ot(1,1)),$sizeTarget:e,$textureColor:i,$textureOpacity:s}){this.$frameSource=t,this.$sizeTarget=e,this.$textureColor=i,this.$textureOpacity=s,this.$frameSourceSerialized=JSON.stringify([[t.minimum.x,t.minimum.y],[t.maximum.x,t.maximum.y]])}}function Z(t){const e=window.localStorage.getItem(t);if(null!==e)return JSON.parse(e)}function W(t){return null!==window.localStorage.getItem(t)}function Y(t){window.localStorage.removeItem(t)}function H(t,e){const i=JSON.stringify(e);void 0!==i&&window.localStorage.setItem(t,i)}class Q{$initiated;constructor(){this.$initiated=!1}initiate(){!0!==this.$initiated&&(this.onInitiate(),this.$initiated=!0)}onInitiate(){}onTerminate(){}onTick({$stage:t,$timetick:e}){}terminate(){if(!1===this.$initiated)return;const t=this.onTerminate();void 0!==t?t.then((()=>{this.$initiated=!1})):this.$initiated=!1}tick({$stage:t,$timetick:e}){!1===this.$initiated&&this.initiate(),this.onTick({$stage:t,$timetick:e})}}class j{$keyframes;$timecode;get timecode(){return this.$timecode}constructor(t=[]){this.$keyframes=[...t].sort(((t,e)=>t.timecode-e.timecode)),this.$timecode=0}seekName(t){const e=this.$keyframes.find((e=>e.name===t));return void 0!==e&&this.seekTimecode(e.timecode),this}seekTimecode(t){return this.$timecode=t,this.$keyframes.forEach((t=>{t.timecode===this.$timecode&&t.onEnter(this)})),this}tick(t){if(0===t)return this;const e=this.$timecode;this.$timecode+=t;const i=this.$timecode;return this.$keyframes.forEach((t=>{t.timecode<=e||t.timecode>i||t.onEnter(this)})),this}}class J{$name;$onEnter;$timecode;get name(){return this.$name}get onEnter(){return this.$onEnter}get timecode(){return this.$timecode}constructor({$name:t,$onEnter:e,$timecode:i}){this.$name=t,this.$onEnter=e,this.$timecode=i}}function K(t){return Array.from(new Set(t))}function tt(t,e){const i=e.indexOf(t);return-1===i?[]:e.splice(i,1)}function et(){return new Promise((t=>{window.requestAnimationFrame(t)}))}function it(){return new Promise((t=>{let e;const i=()=>{!1!==navigator.userActivation.hasBeenActive?(window.cancelAnimationFrame(e),t()):e=window.requestAnimationFrame(i)};e=window.requestAnimationFrame(i)}))}function st(t){return new Promise((e=>{window.setTimeout(e,t)}))}function nt(){return window.crypto.randomUUID()}class ot{$x;$y;get x(){return this.$x}get y(){return this.$y}constructor(t,e){this.$x=t,this.$y=e}static from(t){return t.clone()}add(t){const e=this.$x,i=this.$y;return this.$x=e+t.x,this.$y=i+t.y,this}clone(){const t=this.$x,e=this.$y;return new ot(t,e)}equal(t){return this.$x===t.x&&this.$y===t.y}length(){const t=this.$x,e=this.$y;return Math.sqrt(t*t+e*e)}multiply(t){const e=this.$x,i=this.$y;return this.$x=e*t.x,this.$y=i*t.y,this}negate(){const t=this.$x,e=this.$y;return this.$x=-t,this.$y=-e,this}normalize(){const t=this.$x,e=this.$y;let i=t*t+e*e;return i>0&&(i=1/Math.sqrt(i)),this.$x=t*i,this.$y=e*i,this}rotate(t){const e=this.$x,i=this.$y,s=t*z,n=Math.cos(s),o=Math.sin(s);return this.$x=e*n-i*o,this.$y=e*o+i*n,this}scale(t){const e=this.$x,i=this.$y;return this.$x=e*t,this.$y=i*t,this}subtract(t){const e=this.$x,i=this.$y;return this.$x=e-t.x,this.$y=i-t.y,this}}class rt{$x;$y;$z;get x(){return this.$x}get y(){return this.$y}get z(){return this.$z}constructor(t,e,i){this.$x=t,this.$y=e,this.$z=i}static from(t){return t.clone()}add(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e+t.x,this.$y=i+t.y,this.$z=s+t.z,this}clone(){const t=this.$x,e=this.$y,i=this.$z;return new rt(t,e,i)}equal(t){return this.$x===t.x&&this.$y===t.y&&this.$z===t.z}length(){const t=this.$x,e=this.$y,i=this.$z;return Math.sqrt(t*t+e*e+i*i)}multiply(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e*t.x,this.$y=i*t.y,this.$z=s*t.z,this}negate(){const t=this.$x,e=this.$y,i=this.$z;return this.$x=-t,this.$y=-e,this.$z=-i,this}normalize(){const t=this.$x,e=this.$y,i=this.$z;let s=t*t+e*e+i*i;return s>0&&(s=1/Math.sqrt(s)),this.$x=t*s,this.$y=e*s,this.$z=i*s,this}rotate(t){const e=this.$x,i=this.$y,s=this.$z,n=t.x,o=t.y,r=t.z;let a=o*s-r*i,h=r*e-n*s,c=n*i-o*e,$=o*c-r*h,u=r*a-n*c,d=n*h-o*a;const l=2*t.w;return a*=l,h*=l,c*=l,$*=2,u*=2,d*=2,this.$x=e+a+$,this.$y=i+h+u,this.$z=s+c+d,this}scale(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e*t,this.$y=i*t,this.$z=s*t,this}subtract(t){const e=this.$x,i=this.$y,s=this.$z;return this.$x=e-t.x,this.$y=i-t.y,this.$z=s-t.z,this}}class at{$duration;$intensityFrequencyHigh;$intensityFrequencyLow;get duration(){return this.$duration}get intensityFrequencyHigh(){return this.$intensityFrequencyHigh}get intensityFrequencyLow(){return this.$intensityFrequencyLow}constructor({$duration:t,$intensityFrequencyHigh:e,$intensityFrequencyLow:i}){this.$duration=t,this.$intensityFrequencyHigh=e,this.$intensityFrequencyLow=i}}class ht extends Event{$code;$vibration;get code(){return this.$code}get vibration(){return this.$vibration}constructor(t,e,i){super(t),this.$code=e,this.$vibration=i}}class ct extends Event{$code;$value;get code(){return this.$code}get value(){return this.$value}constructor(t,e,i){super(t),this.$code=e,this.$value=i}}class $t extends Event{$code;get code(){return this.$code}constructor(t,e){super(t),this.$code=e}}const ut=[["StickLeftLeft","StickLeftRight"],["StickLeftUp","StickLeftDown"],["StickRightLeft","StickRightRight"],["StickRightUp","StickRightDown"]],dt=["ClusterRightButtonBottom","ClusterRightButtonRight","ClusterRightButtonLeft","ClusterRightButtonTop","ClusterFrontButtonTopLeft","ClusterFrontButtonTopRight","ClusterFrontButtonBottomLeft","ClusterFrontButtonBottomRight","ClusterCenterButtonLeft","ClusterCenterButtonRight","StickLeftButton","StickRightButton","ClusterLeftButtonTop","ClusterLeftButtonBottom","ClusterLeftButtonLeft","ClusterLeftButtonRight","ClusterCenterButtonCenter"];class lt{static $activated=!1;$indexLastConnected;$stateGamepad;$unloaded;constructor(){this.$stateGamepad={},this.$unloaded=!1,[...dt,...ut.flat()].forEach((t=>{this.$stateGamepad[t]=!1})),window.addEventListener("beforeunload",this.$onBeforeUnload.bind(this)),window.addEventListener("gamepadconnected",this.$onConnect.bind(this)),window.addEventListener("gamepaddisconnected",this.$onDisconnect.bind(this)),window.addEventListener("gamepadvibrate",this.$onVibrate.bind(this)),window.requestAnimationFrame(this.$update.bind(this))}static activate(){!0!==lt.$activated&&(new lt,lt.$activated=!0)}$onBeforeUnload(){this.$unloaded=!0;const t=navigator.getGamepads()[this.$indexLastConnected];void 0!==t&&void 0!==t.vibrationActuator&&t.vibrationActuator.reset()}$onConnect(t){"standard"===t.gamepad.mapping&&(Object.entries(this.$stateGamepad).forEach((([t,e])=>{!0===e&&(this.$stateGamepad[t]=!1,window.dispatchEvent(new $t("gamepadup",t)))})),this.$indexLastConnected=t.gamepad.index,window.dispatchEvent(new $t("gamepadconnect","Connected")))}$onDisconnect(t){t.gamepad.index===this.$indexLastConnected&&(Object.entries(this.$stateGamepad).forEach((([t,e])=>{!0===e&&(this.$stateGamepad[t]=!1,window.dispatchEvent(new $t("gamepadup",t)))})),this.$indexLastConnected=void 0,window.dispatchEvent(new $t("gamepadconnect","Disconnected")))}$onVibrate(t){if(!0===this.$unloaded)return;const e=navigator.getGamepads()[this.$indexLastConnected];void 0!==e&&void 0!==e.vibrationActuator&&(t instanceof $t&&"VibrateEnd"===t.code?e.vibrationActuator.reset():t instanceof ht&&"VibrateStart"===t.code&&e.vibrationActuator.playEffect("dual-rumble",{startDelay:0,duration:t.vibration.duration,strongMagnitude:t.vibration.intensityFrequencyLow,weakMagnitude:t.vibration.intensityFrequencyHigh}))}$update(){const t=navigator.getGamepads()[this.$indexLastConnected];t instanceof Gamepad&&(dt.forEach(((e,i)=>{const s=t.buttons[i];!0===s.pressed?(!1===this.$stateGamepad[e]&&(this.$stateGamepad[e]=!0),window.dispatchEvent(new $t("gamepaddown",e)),window.dispatchEvent(new ct("gamepadanalog",e,s.value))):!0===this.$stateGamepad[e]&&(this.$stateGamepad[e]=!1,window.dispatchEvent(new $t("gamepadup",e)))})),t.axes.forEach(((t,e)=>{const[i,s]=ut[e];t<=-.5?(!0===this.$stateGamepad[s]&&(this.$stateGamepad[s]=!1,window.dispatchEvent(new $t("gamepadup",s))),this.$stateGamepad[i]=!0,window.dispatchEvent(new $t("gamepaddown",i)),window.dispatchEvent(new ct("gamepadanalog",i,(t-.5*Math.sign(t))/.5))):t>=.5?(!0===this.$stateGamepad[i]&&(this.$stateGamepad[i]=!1,window.dispatchEvent(new $t("gamepadup",i))),this.$stateGamepad[s]=!0,window.dispatchEvent(new $t("gamepaddown",s)),window.dispatchEvent(new ct("gamepadanalog",s,(t-.5*Math.sign(t))/.5))):(!0===this.$stateGamepad[i]&&(this.$stateGamepad[i]=!1,window.dispatchEvent(new $t("gamepadup",i))),!0===this.$stateGamepad[s]&&(this.$stateGamepad[s]=!1,window.dispatchEvent(new $t("gamepadup",s))))}))),window.requestAnimationFrame(this.$update.bind(this))}}class mt extends Q{constructor(){super()}onTick({$stage:t,$timetick:e}){t.actors.forEach((t=>{t.onTick(e)}))}}class pt extends Q{static DELAYCONTEXTCLEARSAFE=1e3;$cache;$context;$mappingSoundsPlaying;constructor(){super()}$createValuesCurveFadeOut(t){return[1*t-1,0*t-1]}$loadAudio(t){return new Promise((e=>{t.arrayBuffer().then((i=>this.$context.decodeAudioData(i).then((i=>{this.$cache.set(t.url,i),e(i)}))))}))}$prepareAudio(t){!0!==this.$cache.has(t)&&(this.$cache.set(t,void 0),fetch(t).then((t=>this.$loadAudio(t))))}$terminateSound(t){const{$audio:e,$gain:i,$startTime:s}=this.$mappingSoundsPlaying.get(t);!1===t.loop&&this.$context.currentTime>s+Math.max(0,e.buffer.duration-t.durationFadeOut/1e3)||(i.gain.cancelScheduledValues(this.$context.currentTime),i.gain.setValueCurveAtTime(this.$createValuesCurveFadeOut(t.volume),this.$context.currentTime,Math.min(e.buffer.duration,t.durationFadeOut/1e3)),this.$mappingSoundsPlaying.delete(t),e.onended=()=>{e.disconnect(),i.disconnect()})}hasAssetLoaded(t){return!1===this.$initiated&&this.initiate(),!0===this.$cache.has(t)}loadAudio(t){return!1===this.$initiated&&this.initiate(),!0===this.$cache.has(t.url)?new Promise((e=>{e(this.$cache.get(t.url))})):(this.$cache.set(t.url,void 0),this.$loadAudio(t))}onInitiate(){this.$cache=new Map,this.$context=new AudioContext,this.$mappingSoundsPlaying=new Map}onTerminate(){let t=0;return Array.from(this.$mappingSoundsPlaying.keys()).forEach((e=>{e.durationFadeOut>t&&(t=e.durationFadeOut),this.$terminateSound(e)})),new Promise((e=>{window.setTimeout((()=>{this.$context.close().then((()=>{this.$context=void 0,e()}))}),t+pt.DELAYCONTEXTCLEARSAFE)}))}onTick({$stage:t}){const e=Array.from(this.$mappingSoundsPlaying.keys());t.actors.forEach((t=>{t.sounds.forEach((i=>{if(!0===this.$mappingSoundsPlaying.has(i))return void tt(i,e);if(this.$prepareAudio(i.audio),void 0===this.$cache.get(i.audio))return;const s=this.$cache.get(i.audio),n=this.$context.createBufferSource();n.buffer=s,n.connect(this.$context.destination),n.start(0);const o=this.$context.createGain();o.gain.value=i.volume-1,o.connect(this.$context.destination),n.connect(o),this.$mappingSoundsPlaying.set(i,{$audio:n,$gain:o,$startTime:this.$context.currentTime}),!0!==i.loop?(o.gain.setValueCurveAtTime(this.$createValuesCurveFadeOut(i.volume),this.$context.currentTime+Math.max(0,n.buffer.duration-i.durationFadeOut/1e3),Math.min(n.buffer.duration,i.durationFadeOut/1e3)),n.onended=()=>{n.disconnect(),o.disconnect(),this.$mappingSoundsPlaying.delete(i),t.removeSound(i),t.onSoundFinish(i)}):n.loop=!0}))})),e.forEach((t=>{this.$terminateSound(t)}))}}class ft extends Q{$current;$previous;constructor(){super()}$hasCollisionPrevious(t,e){return void 0!==this.$previous.find((([i,s])=>t===i&&e===s))}onInitiate(){this.$current=[],this.$previous=[]}onTick({$stage:t}){const e=[],i=[],s=[],n=[];t.actors.forEach((t=>{if(!1!==t.hasCollider())switch(t.collider.type){case d:i.push(t);break;case l:s.push(t);break;case m:n.push(t)}}));const o=[...n,...s];0!==o.length&&(i.forEach((t=>{const i=t.collider.boundaries.clone().translate(t.translation),s=new F(i.center,i.center);o.forEach((i=>{const n=i.collider.boundaries.clone().translate(i.translation),o=F.distanceManhattan(s,n);e.push({$distance:o,$dynamic:t,$inert:i})}))})),e.sort(((t,e)=>t.$distance-e.$distance)),e.forEach((e=>{const{$dynamic:i,$inert:s}=e;if(!1===t.hasActor(i))return;if(!1===t.hasActor(s))return;const n=i.collider.boundaries.clone().translate(i.translation),o=s.collider.boundaries.clone().translate(s.translation),r=F.overlapX(n,o);if(r<=0)return;const a=F.overlapY(n,o);if(a<=0)return;this.$current.push([i,s]);const h=Math.sign(s.translation.x-i.translation.x),c=Math.sign(s.translation.y-i.translation.y),$=r<=a,u=a<=r;if(!1===i.collider.traversable&&!1===s.collider.traversable){const t=new ot($?-h*r:0,u?-c*a:0);i.translate(t)}const d=!0===$&&1===h,l=!0===u&&1===c,m=!0===u&&-1===c,p=!0===$&&-1===h;!1===this.$hasCollisionPrevious(i,s)&&(i.onCollideEnter({$actor:s,$east:d,$north:l,$south:m,$west:p}),s.onCollideEnter({$actor:i,$east:p,$north:m,$south:l,$west:d})),i.onCollide({$actor:s,$east:d,$north:l,$south:m,$west:p}),s.onCollide({$actor:i,$east:p,$north:m,$south:l,$west:d})})),this.$previous.filter((([t,e])=>void 0===this.$current.find((([i,s])=>i===t&&s===e)))).forEach((([t,e])=>{t.onCollideLeave(e),e.onCollideLeave(t)})),this.$previous=[...this.$current],this.$current=[])}}class xt extends Q{$container;$events;$inputs;$inputsAnalog;constructor({$container:t}){super(),this.$container=t}$stack(t){t.preventDefault(),this.$events.push(t)}getInput(t){const e=this.$inputs[t];return void 0!==e&&e}getInputAnalog(t){const e=this.$inputsAnalog[t];return void 0===e?0:e}onInitiate(){this.$events=[],this.$inputs={},this.$inputsAnalog={},window.addEventListener("blur",this.$stack.bind(this)),window.addEventListener("contextmenu",this.$stack.bind(this)),window.addEventListener("gamepadanalog",this.$stack.bind(this)),window.addEventListener("gamepadconnect",this.$stack.bind(this)),window.addEventListener("gamepaddown",this.$stack.bind(this)),window.addEventListener("gamepadup",this.$stack.bind(this)),this.$container.addEventListener("keydown",this.$stack.bind(this)),this.$container.addEventListener("keyup",this.$stack.bind(this))}onTerminate(){window.removeEventListener("blur",this.$stack.bind(this)),window.removeEventListener("contextmenu",this.$stack.bind(this)),window.removeEventListener("gamepadanalog",this.$stack.bind(this)),window.removeEventListener("gamepadconnect",this.$stack.bind(this)),window.removeEventListener("gamepaddown",this.$stack.bind(this)),window.removeEventListener("gamepadup",this.$stack.bind(this)),this.$container.removeEventListener("keydown",this.$stack.bind(this)),this.$container.removeEventListener("keyup",this.$stack.bind(this))}onTick(){for(;this.$events.length>0;){const t=this.$events.shift();"blur"===t.type?(this.$inputs={},this.$inputsAnalog={}):t instanceof ct&&"gamepadanalog"===t.type?this.$inputsAnalog[t.code]=t.value:t instanceof $t&&"gamepaddown"===t.type?void 0===this.$inputs[t.code]&&(this.$inputs[t.code]=!0):t instanceof $t&&"gamepadup"===t.type?void 0!==this.$inputs[t.code]&&delete this.$inputs[t.code]:t instanceof KeyboardEvent&&"keydown"===t.type?void 0===this.$inputs[t.code]&&(this.$inputs[t.code]=!0):t instanceof KeyboardEvent&&"keyup"===t.type&&void 0!==this.$inputs[t.code]&&delete this.$inputs[t.code]}}}class gt extends Q{static UNITTEXTURE0=0;static UNITTEXTURE1=1;static UNITTEXTURE2=2;$bufferPosition;$cache;$canvas;$color;$container;$context;$indices;$locationsAttribute;$locationsUniform;$mappingBuffersUv;$program;$resizeOberver;$resolution;$shaderFragment;$shaderVertex;$textureColorDefault;$textureOpacityDefault;constructor({$color:t=new rt(0,0,0),$container:e,$resolution:i}){super(),this.$color=t,this.$container=e,this.$resolution=i}$createBufferPositions(){const t=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ARRAY_BUFFER,t),this.$context.bufferData(this.$context.ARRAY_BUFFER,new Float32Array([-.5,-.5,-.5,.5,.5,.5,.5,-.5]),this.$context.STATIC_DRAW),this.$bufferPosition=t}$createBufferUvsOnce(t){if(void 0!==this.$mappingBuffersUv[t.frameSourceSerialized])return;const e=t.frameSource,i=[e.minimum.x,e.maximum.y,e.minimum.x,e.minimum.y,e.maximum.x,e.minimum.y,e.maximum.x,e.maximum.y],s=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ARRAY_BUFFER,s),this.$context.bufferData(this.$context.ARRAY_BUFFER,new Float32Array(i),this.$context.STATIC_DRAW),this.$mappingBuffersUv[t.frameSourceSerialized]=s}$createIndices(){const t=[0,1,2,3],e=this.$context.createBuffer();this.$context.bindBuffer(this.$context.ELEMENT_ARRAY_BUFFER,e),this.$context.bufferData(this.$context.ELEMENT_ARRAY_BUFFER,new Uint32Array(t),this.$context.STATIC_DRAW),this.$indices=t.length}$createLocationsAttribute(t,e){Object.keys(e.attributes).forEach((e=>{this.$locationsAttribute[e]=this.$context.getAttribLocation(t,e)}))}$createLocationsUniform(t,e){Object.keys(e.uniforms).forEach((e=>{this.$locationsUniform[e]=this.$context.getUniformLocation(t,e)}))}$createProgram(t){this.$shaderVertex=this.$context.createShader(this.$context.VERTEX_SHADER),this.$context.shaderSource(this.$shaderVertex,t.sourceVertex),this.$context.compileShader(this.$shaderVertex),this.$shaderFragment=this.$context.createShader(this.$context.FRAGMENT_SHADER),this.$context.shaderSource(this.$shaderFragment,t.sourceFragment),this.$context.compileShader(this.$shaderFragment),this.$program=this.$context.createProgram(),this.$context.attachShader(this.$program,this.$shaderVertex),this.$context.attachShader(this.$program,this.$shaderFragment),this.$context.linkProgram(this.$program)}$createTexture(t,e){const i=this.$context.createTexture();return this.$context.activeTexture(e),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_MIN_FILTER,this.$context.NEAREST),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_MAG_FILTER,this.$context.NEAREST),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_WRAP_S,this.$context.CLAMP_TO_EDGE),this.$context.texParameteri(this.$context.TEXTURE_2D,this.$context.TEXTURE_WRAP_T,this.$context.CLAMP_TO_EDGE),this.$context.texImage2D(this.$context.TEXTURE_2D,0,this.$context.RGBA,this.$context.RGBA,this.$context.UNSIGNED_BYTE,t),i}$createTextureDefault(t,e){const i=this.$context.createTexture();return this.$context.activeTexture(this.$context.TEXTURE0+e),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$context.texImage2D(this.$context.TEXTURE_2D,0,this.$context.RGBA,1,1,0,this.$context.RGBA,this.$context.UNSIGNED_BYTE,new Uint8Array([t.x,t.y,t.z,255])),i}$initiateCanvas(){this.$canvas=document.createElement("canvas"),this.$canvas.style.width="100%",this.$canvas.style.height="100%",this.$canvas.style.display="block",this.$canvas.style.outline="0",this.$canvas.style.imageRendering="pixelated",this.$container.appendChild(this.$canvas),this.$resize()}$initiateContext(){this.$context=this.$canvas.getContext("webgl2",{antialias:!1}),this.$context.frontFace(this.$context.CW),this.$context.enable(this.$context.CULL_FACE),this.$context.cullFace(this.$context.BACK),this.$context.enable(this.$context.BLEND),this.$context.blendFunc(this.$context.SRC_ALPHA,this.$context.ONE_MINUS_SRC_ALPHA),this.$createProgram(G),this.$context.useProgram(this.$program),this.$createLocationsUniform(this.$program,G),this.$createLocationsAttribute(this.$program,G),this.$createBufferPositions(),this.$createIndices(),this.$textureColorDefault=this.$createTextureDefault(new rt(127,127,127),gt.UNITTEXTURE1),this.$textureOpacityDefault=this.$createTextureDefault(new rt(255,255,255),gt.UNITTEXTURE2),window.addEventListener("beforeunload",this.$onBeforeUnload.bind(this))}$loadTexture(t,e){return new Promise((i=>{t.blob().then((t=>createImageBitmap(t))).then((s=>{const n=this.$createTexture(s,e);this.$cache.set(t.url,n),i(n)}))}))}$onBeforeUnload(){this.$context instanceof WebGL2RenderingContext!=0&&null!==this.$context.getExtension("WEBGL_lose_context")&&this.$context.getExtension("WEBGL_lose_context").loseContext()}$prepareTexture(t,e){!0!==this.$cache.has(t)&&(this.$cache.set(t,void 0),fetch(t).then((t=>this.$loadTexture(t,e))))}$resetCanvas(t,e){this.$context.clearColor(this.$color.x,this.$color.y,this.$color.z,1),this.$context.clearDepth(1),this.$context.viewport(0,0,t,e),this.$context.clear(this.$context.COLOR_BUFFER_BIT|this.$context.DEPTH_BUFFER_BIT)}$resize(){const t=this.$resolution.x,e=this.$resolution.y,i=Math.max(t,Math.floor(e*this.$canvas.clientWidth/this.$canvas.clientHeight)),s=Math.max(e,Math.floor(t*this.$canvas.clientHeight/this.$canvas.clientWidth));this.$canvas.setAttribute("width",""+2*Math.floor(i/2)),this.$canvas.setAttribute("height",""+2*Math.floor(s/2))}$sendAttribute(t,e,i){if(void 0!==t.attributes[e])switch(t.attributes[e]){case"vec2":{this.$context.bindBuffer(this.$context.ARRAY_BUFFER,i);const t=this.$locationsAttribute[e];this.$context.vertexAttribPointer(t,2,this.$context.FLOAT,!1,0,0),this.$context.enableVertexAttribArray(t);break}case"vec3":{this.$context.bindBuffer(this.$context.ARRAY_BUFFER,i);const t=this.$locationsAttribute[e];this.$context.vertexAttribPointer(t,3,this.$context.FLOAT,!1,0,0),this.$context.enableVertexAttribArray(t);break}}}$sendUniform(t,e,i){if(void 0!==t.uniforms[e])switch(t.uniforms[e]){case"bool":case"int":case"sampler2D":this.$context.uniform1i(this.$locationsUniform[e],i);break;case"bool[]":case"int[]":this.$context.uniform1iv(this.$locationsUniform[e],i);break;case"float":this.$context.uniform1f(this.$locationsUniform[e],i);break;case"float[]":this.$context.uniform1fv(this.$locationsUniform[e],i);break;case"mat4":case"mat4[]":this.$context.uniformMatrix4fv(this.$locationsUniform[e],!1,i);break;case"vec2":case"vec2[]":this.$context.uniform2fv(this.$locationsUniform[e],i);break;case"vec3":case"vec3[]":this.$context.uniform3fv(this.$locationsUniform[e],i)}}$terminateContext(){this.$context.deleteBuffer(this.$bufferPosition),Object.values(this.$mappingBuffersUv).forEach((t=>{this.$context.deleteBuffer(t)})),this.$context.deleteTexture(this.$textureColorDefault),this.$context.deleteTexture(this.$textureOpacityDefault),this.$cache.forEach((t=>{this.$context.deleteTexture(t)})),this.$context.deleteShader(this.$shaderFragment),this.$context.deleteShader(this.$shaderVertex),this.$context.deleteProgram(this.$program),this.$context=void 0}hasAssetLoaded(t){return!1===this.$initiated&&this.initiate(),!0===this.$cache.has(t)}loadTexture(t){return!1===this.$initiated&&this.initiate(),!0===this.$cache.has(t.url)?new Promise((e=>{e(this.$cache.get(t.url))})):(this.$cache.set(t.url,void 0),this.$loadTexture(t,this.$context.TEXTURE0+gt.UNITTEXTURE0))}onInitiate(){this.$cache=new Map,this.$indices=0,this.$locationsAttribute={},this.$locationsUniform={},this.$mappingBuffersUv={},this.$initiateCanvas(),this.$initiateContext(),this.$resizeOberver=new ResizeObserver(this.$resize.bind(this)),this.$resizeOberver.observe(this.$container)}onTerminate(){this.$terminateContext(),this.$resizeOberver.disconnect(),this.$container.removeChild(this.$canvas),window.removeEventListener("beforeunload",this.$onBeforeUnload.bind(this))}onTick({$stage:t}){this.$resetCanvas(this.$canvas.width,this.$canvas.height),this.$sendUniform(G,"uniformAspect",[this.$canvas.width,this.$canvas.height]),this.$sendUniform(G,"uniformTranslationPointOfView",[Math.floor(t.pointOfView.translation.x),Math.floor(t.pointOfView.translation.y)]),this.$sendAttribute(G,"attributePosition",this.$bufferPosition);const e=[...t.actors];e.sort(((t,e)=>t.zIndex-e.zIndex)),e.forEach((t=>{if(!1===t.hasSprite())return;if(!1===t.visible)return;let e=this.$textureColorDefault;this.$prepareTexture(t.sprite.textureColor,this.$context.TEXTURE0+gt.UNITTEXTURE1),void 0!==this.$cache.get(t.sprite.textureColor)&&(e=this.$cache.get(t.sprite.textureColor)),this.$context.activeTexture(this.$context.TEXTURE0+gt.UNITTEXTURE1),this.$context.bindTexture(this.$context.TEXTURE_2D,e),this.$sendUniform(G,"uniformTextureColor",gt.UNITTEXTURE1);let i=this.$textureOpacityDefault;void 0!==t.sprite.textureOpacity&&(this.$prepareTexture(t.sprite.textureOpacity,this.$context.TEXTURE0+gt.UNITTEXTURE2),void 0!==this.$cache.get(t.sprite.textureOpacity)&&(i=this.$cache.get(t.sprite.textureOpacity))),this.$context.activeTexture(this.$context.TEXTURE0+gt.UNITTEXTURE2),this.$context.bindTexture(this.$context.TEXTURE_2D,i),this.$sendUniform(G,"uniformTextureOpacity",gt.UNITTEXTURE2),this.$sendUniform(G,"uniformSize",[t.sprite.sizeTarget.x,t.sprite.sizeTarget.y]),this.$sendUniform(G,"uniformTranslation",[Math.floor(t.translation.x),Math.floor(t.translation.y)]),this.$createBufferUvsOnce(t.sprite),this.$sendAttribute(G,"attributeUvmapping",this.$mappingBuffersUv[t.sprite.frameSourceSerialized]),this.$context.drawElements(this.$context.TRIANGLE_FAN,this.$indices,this.$context.UNSIGNED_INT,0)}))}setColor(t){this.$color=t}setResolution(t){this.$resolution=t.clone(),this.$resize()}}class vt extends Q{static DELAYVIBRATIONEND=1e3;$mappingVibrationsPlaying;constructor(){super()}onInitiate(){this.$mappingVibrationsPlaying=new Map}onTerminate(){window.dispatchEvent(new $t("gamepadvibrate",S))}onTick({$stage:t,$timetick:e}){const i=Array.from(this.$mappingVibrationsPlaying.keys());t.actors.forEach((t=>{const s=[];t.vibrations.forEach((t=>{if(!1===this.$mappingVibrationsPlaying.has(t))return void this.$mappingVibrationsPlaying.set(t,0);const n=this.$mappingVibrationsPlaying.get(t)+e;n>=t.duration?s.push(t):(this.$mappingVibrationsPlaying.set(t,n),tt(t,i))})),s.forEach((e=>{t.removeVibration(e)}))})),i.forEach((t=>{this.$mappingVibrationsPlaying.delete(t)}));const s=Array.from(this.$mappingVibrationsPlaying.keys());let n=0,o=0;s.forEach((t=>{n=Math.max(n,t.intensityFrequencyHigh),o=Math.max(o,t.intensityFrequencyLow)})),window.dispatchEvent(new ht("gamepadvibrate",A,new at({$duration:vt.DELAYVIBRATIONEND,$intensityFrequencyHigh:n,$intensityFrequencyLow:o})))}}}},o={};function r(t){var e=o[t];if(void 0!==e)return e.exports;var i=o[t]={exports:{}};return n[t](i,i.exports,r),i.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",i="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",s=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},r.a=(n,o,r)=>{var a;r&&((a=[]).d=-1);var h,c,$,u=new Set,d=n.exports,l=new Promise(((t,e)=>{$=e,c=t}));l[e]=d,l[t]=t=>(a&&t(a),u.forEach(t),l.catch((t=>{}))),n.exports=l,o((n=>{var o;h=(n=>n.map((n=>{if(null!==n&&"object"==typeof n){if(n[t])return n;if(n.then){var o=[];o.d=0,n.then((t=>{r[e]=t,s(o)}),(t=>{r[i]=t,s(o)}));var r={};return r[t]=t=>t(o),r}}var a={};return a[t]=t=>{},a[e]=n,a})))(n);var r=()=>h.map((t=>{if(t[i])throw t[i];return t[e]})),c=new Promise((e=>{(o=()=>e(r)).r=0;var i=t=>t!==a&&!u.has(t)&&(u.add(t),t&&!t.d&&(o.r++,t.push(o)));h.map((e=>e[t](i)))}));return o.r?c:r()}),(t=>(t?$(l[i]=t):c(d),s(a)))),a&&a.d<0&&(a.d=0)},r.d=(t,e)=>{for(var i in e)r.o(e,i)&&!r.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t;r.g.importScripts&&(t=r.g.location+"");var e=r.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var s=i.length-1;s>-1&&(!t||!/^http(s?):/.test(t));)t=i[s--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),r.p=t})(),r(864)})();
//# sourceMappingURL=bundle.js.map